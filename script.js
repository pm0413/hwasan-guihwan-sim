document.addEventListener("DOMContentLoaded", function () {

    // ================= 1. ì„¤ì • ë° ìƒìˆ˜ ì •ì˜ =================
    
    // ê´€ê³„ ë‹¨ê³„ ì„¤ì •
    const REL_LEVELS = {
        intimacy: [ 
            { score: 0, title: "ì•„ëŠ”ì‚¬ì´" },
            { score: 100, title: "ì¹œìš°" },
            { score: 300, title: "ì ˆì¹œ" },
            { score: 500, title: "ê¸ˆë€ì§€êµ" },
            { score: 700, title: "ì§€ê¸°ì§€ìš°" },
            { score: 1000, title: "ê´€í¬ì§€êµ" }
        ],
        affection: [ 
            { score: 0, title: "-" },
            { score: 10, title: "ê´€ì‹¬ìˆìŒ" },
            { score: 50, title: "í˜¸ê°" },
            { score: 100, title: "ì¸íƒ€ëŠ” ê´€ê³„" },
            { score: 200, title: "ì—°ì¸" },
            { score: 500, title: "ë¶€ë¶€" }
        ]
    };

    // ì„±ê²© ëª©ë¡
    const personalityList = ["ëŠ¥ê¸€ë§ìŒ", "ë¬´ë˜í•¨", "ì§ˆíˆ¬ë§ìŒ"];

    // ê³„ì ˆ ì •ë³´
    const seasonInfo = {
        spring: { name: "ë´„", icon: "ğŸŒ¸", filter: "none" },
        summer: { name: "ì—¬ë¦„", icon: "â˜€ï¸", filter: "saturate(1.2) brightness(1.1)" },
        autumn: { name: "ê°€ì„", icon: "ğŸ", filter: "sepia(0.4) contrast(1.1)" },
        winter: { name: "ê²¨ìš¸", icon: "â„ï¸", filter: "brightness(0.9) hue-rotate(10deg) grayscale(0.3)" }
    };

    // ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ ë°ì´í„°
    const specialEventDB = {
        spring: { title: "â­ï¸ ì¢…ë‚¨íŒŒ í˜¼ë‚´ì£¼ê¸°", log: "ì¢…ë‚¨ì˜ ë©ì²­ì´ë“¤ì„ ë‘ë“¤ê²¨ íŒ¨ì¤¬ìŠµë‹ˆë‹¤!", talk: { dangbo: "í˜•ë‹˜ êµ¬ì—­ì—ì„œ ì–¼ì©¡ê±°ë¦¬ë‹¤ë‹ˆ.", chung: "ë‹¤ì‹  ëª» ì˜¤ê²Œ ë‹¤ë¦¬ë¥¼ ë¶„ì§ˆëŸ¬ë†”!" } },
        summer: { title: "â­ï¸ ìˆ˜ë°• ì„œë¦¬", log: "ë‚¨ì˜ ë°­ì—ì„œ ìˆ˜ë°•ì„ ì„œë¦¬í•´ ë¨¹ì—ˆìŠµë‹ˆë‹¤.", talk: { dangbo: "ì—­ì‹œ í›”ì³ ë¨¹ëŠ” ê²Œ ì œë§›ì´ì£ .", chung: "ì•„ì‚­í•˜ë‹ˆ ì¢‹ë„¤!" } },
        autumn: { title: "â­ï¸ ìˆ ë… ë„ì¥ ê¹¨ê¸°", log: "ê°ì”ì˜ ìˆ ì„ ëª¨ì¡°ë¦¬ ë§ˆì…”ë²„ë ¸ìŠµë‹ˆë‹¤.", talk: { dangbo: "í˜•ë‹˜, í•œ ë³‘ ë”?", chung: "ì˜¤ëŠ˜ ë‹¤ ì£½ëŠ” ê±°ì•¼!" } },
        winter: { title: "â­ï¸ ì„¤ì› ë¹„ë¬´", log: "ëˆˆë°­ì—ì„œ ê²©ë ¬í•œ ë¹„ë¬´ë¥¼ í¼ì³¤ìŠµë‹ˆë‹¤.", talk: { dangbo: "ì†ì´ ê³±ì•„ì„œ ì œëŒ€ë¡œ ëª» ë˜ì§€ê² ì†Œ.", chung: "í•‘ê³„ ëŒ€ì§€ ë§ˆë¼!" } }
    };

    // ================= 2. ìºë¦­í„° ë° ëŒ€ì‚¬ ë°ì´í„° =================
    const charData = {
        'dangbo': {
            name: "ë‹¹ë³´", title: "ì•”ì¡´(æš—å°Š)", gender: "ë‚¨ì„±", trait: "ëŠ¥ê¸€ë§ìŒ", position: "left",
            intimacy: 0, affection: 0, maxIntimacyLevelIdx: 0, maxAffectionLevelIdx: 0,
            relationshipTitle: "ì•„ëŠ”ì‚¬ì´", loveTitle: "-",
            inventory: ["ë¹„ë„ x12", "ë…ë³‘", "ìµœê³ ê¸‰ ìˆ "],
            relations: [{ target: "ì²­ëª…", rel: "ì˜í˜•ì œ", desc: "í‰ìƒì„ ë”°ë¥¼ ì£¼êµ°ì´ì {í˜¸ì¹­}." }],
            img: "character/ë‹¹ë³´.gif", color: "#4CAF50", x: 30, y: 60
        },
        'chung': {
            name: "ì²­ëª…", title: "ë§¤í™”ê²€ì¡´(æ¢…èŠ±åŠå°Š)", gender: "ë‚¨ì„±", trait: "ë¬´ë˜í•¨", position: "right",
            intimacy: 0, affection: 0, maxIntimacyLevelIdx: 0, maxAffectionLevelIdx: 0,
            relationshipTitle: "ì•„ëŠ”ì‚¬ì´", loveTitle: "-",
            inventory: ["ë§¤í™”ê²€", "ë‹¹ê³¼", "êµ°ë§Œë‘"],
            relations: [{ target: "ë‹¹ë³´", rel: "ì˜í˜•ì œ", desc: "ê·€ì°®ì§€ë§Œ ë¯¿ìŒì§í•œ ë…€ì„." }],
            img: "character/ì²­ëª….gif", color: "#F44336", x: 70, y: 60
        }
    };

    const dialogDB = {
        "dangbo_start": {
            "ëŠ¥ê¸€ë§ìŒ": [
                { t1: "ì‚¬ì²œë‹¹ê°€ë¡œ ë†€ëŸ¬ ì˜¤ì‹­ì‡¼. {í˜¸ì¹­} ì¢‹ì•„í•˜ì‹œëŠ” ë…ì£¼ê°€ ì•„ì£¼ ë§ìŠµë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ë…ì£¼? ë‚´ ê°„ì´ ë²„í…¨ì¤„ê¹Œ ëª¨ë¥´ê² ë„¤.", log: "ì²­ëª…ì´ ë¤ë¤í•˜ê²Œ ìˆ  ê³„ì‚°ì„ í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ê°€ë©´ ë„¤ê°€ ë‹¤ ì˜ëŠ” ê±°ì§€? ë‹¹ê°€ ì°½ê³  í„¸ëŸ¬ ê°„ë‹¤!", log: "ì²­ëª…ì´ ì‹ ì´ ë‚˜ì„œ ë§ì¥êµ¬ì¹©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë‹¹ê°€ì— ë‚˜ ë§ê³  ë˜ ëˆ„êµ¬ ë¶€ë¥¸ ë†ˆ ìˆëƒ?", log: "ì²­ëª…ì´ ê´œíˆ ì‚ë”±í•˜ê²Œ ë¬»ìŠµë‹ˆë‹¤." } } },
                { t1: "{í˜¸ì¹­}, ì €ë‘ ë¹„ë¬´ë‚˜ í•œ íŒ ì–´ë– ì‹­ë‹ˆê¹Œ? ì‚´ì‚´ í•´ë“œë¦´ê²Œ.", reaction: { "ë¬´ë˜í•¨": { t2: "ê·€ì°®ë‹¤. ì ì´ë‚˜ ìë¼.", log: "ì²­ëª…ì´ í•˜í’ˆì„ í•˜ë©° ê±°ì ˆí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì‚´ì‚´? ëŒ€ê°€ë¦¬ ê¹¨ì ¸ë´ì•¼ ì •ì‹  ì°¨ë¦¬ì§€?", log: "ì²­ëª…ì´ ë¹„ë¦¿í•˜ê²Œ ì›ƒìœ¼ë©° ê²€ì„ ì¡ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë‚˜ë‘ ëª¸ ì„ê³  ì‹¶ì–´ì„œ ì•ˆë‹¬ì´ ë‚¬êµ¬ë‚˜?", log: "ì²­ëª…ì´ ë¬˜í•œ í‘œì •ìœ¼ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤." } } },
                { t1: "ì´ ë‹¹ë³´ê°€ {í˜¸ì¹­} ìƒê°í•´ì„œ ì‚° ì†Œì¤‘í•œ ë‹¹ê³¼ì…ë‹ˆë‹¤. ì, ì•„~ í•˜ì‹­ì‡¼.", reaction: { "ë¬´ë˜í•¨": { t2: "ì£¼ë ¤ë©´ ê·¸ëƒ¥ ì¤˜ë¼. ì§•ê·¸ëŸ½ê²Œ.", log: "ì²­ëª…ì´ ë‹¹ê³¼ë§Œ ì™ ëºì–´ê°‘ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì†ê°€ë½ê¹Œì§€ ì”¹ì–´ë¨¹ì–´ë„ ë˜ëƒ?", log: "ì²­ëª…ì´ ì…ì„ í¬ê²Œ ë²Œë¦¬ë©° ì¥ë‚œì„ ì¹©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë„ˆ ë‹¤ë¥¸ ë†ˆí•œí…Œë„ ì´ë ‡ê²Œ ë¨¹ì—¬ì£¼ëƒ?", log: "ì²­ëª…ì´ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ëˆˆì´ˆë¦¬ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤." } } },
                { t1: "ìš”ì¦˜ í™”ì‚° ë†ˆë“¤ì€ ì•„ì£¼ ê¸°ìš´ì´ ë„˜ì¹˜ë”êµ°ìš”. {í˜¸ì¹­} ë‹®ì•„ì„œ ê·¸ëŸ°ê°€?", reaction: { "ë¬´ë˜í•¨": { t2: "ê·¸ëƒ¥ ë‚´ë²„ë ¤ ë‘¬ë¼. ì• ë“¤ì´ë‹¤.", log: "ì²­ëª…ì´ ë©€ë¦¬ ìˆ˜ë ¨í•˜ëŠ” ì œìë“¤ì„ ë´…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë‚˜ ë‹®ì•˜ìœ¼ë©´ ë²Œì¨ ì‚¬ê³  ì³ë„ ëª‡ ë²ˆì€ ì³¤ì§€.", log: "ì²­ëª…ì´ ë‚„ë‚„ê±°ë¦¬ë©° ì›ƒìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ê·¸ë†ˆë“¤ ë³´ëŠë¼ ë‚´ê°€ ì–¼ë§ˆë‚˜ ë°”ìœë°. ë„Œ ì ìì½” ìˆì–´.", log: "ì²­ëª…ì´ í”¼ê³¤í•œ ë“¯ ëˆˆì„ ë¹„ë¹•ë‹ˆë‹¤." } } },
                { t1: "{í˜¸ì¹­} ì™œ ìê¾¸ ì˜ìƒê²¨ì§€ì‹œëŠ” ê²ë‹ˆê¹Œ? ì´ ì•„ìš° ì‹¬ì¥ì´ ë–¨ë ¤ì„œ ì›.", reaction: { "ë¬´ë˜í•¨": { t2: "í—›ì†Œë¦¬ ë§ê³  ì ì´ë‚˜ ì.", log: "ì²­ëª…ì´ ê·€ì°®ë‹¤ëŠ” ë“¯ ê³ ê°œë¥¼ ëŒë¦½ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë„¤ ì‹¬ì¥ë§Œ ë–¨ë¦¬ê² ëƒ? ì˜¨ ê°•í˜¸ê°€ ë‚œë¦¬ë‹¤.", log: "ì²­ëª…ì´ ìì•„ë„ì·¨ì— ë¹ ì ¸ ëŒ€ê¾¸í•©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì…ë§Œ ì‚´ì•„ì„œ... ë‚˜ ë§ê³  ë”´ ë†ˆí•œí…Œ ê·¸ ì†Œë¦¬ í•˜ë©´ ì£½ëŠ”ë‹¤.", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì…ì„ íˆ­ ì¹©ë‹ˆë‹¤." } } }
            ],
            "ì§ˆíˆ¬ë§ìŒ": [
                { t1: "ì•„ê¹Œ ê·¸ ì¥ë¬¸ì¸ì´ë‘ ë¬´ìŠ¨ ì–˜ê¸°ë¥¼ ê·¸ë ‡ê²Œ ì˜¤ë˜ í•˜ì‹  ê²ë‹ˆê¹Œ?", reaction: { "ë¬´ë˜í•¨": { t2: "ê·¸ëƒ¥ ë¬¸íŒŒ ìš´ì˜ ì–˜ê¸°ì§€. ë³„ê±° ì—†ë‹¤.", log: "ì²­ëª…ì´ ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë‹µí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì™œ, ì§ˆíˆ¬ ë‚˜ëƒ? ì•„ì£¼ ê·€ì—¬ì›Œ ì£½ê² ë„¤.", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ë¨¸ë¦¬ë¥¼ ì“°ë‹¤ë“¬ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë„ˆë„ ì•„ê¹Œ ë‹¹ê°€ ì• ë“¤ì´ë‘ ì›ƒê³  ë– ë“¤ë”ë§Œ!", log: "ë‘ ì‚¬ëŒ ì‚¬ì´ì— ë¬˜í•œ ê¸°ì‹¸ì›€ì´ íë¦…ë‹ˆë‹¤." } } },
                { t1: "ì œ ë¹„ë„ê°€ ì¢‹ìŠµë‹ˆê¹Œ, í™”ì‚°ì˜ ê²€ì´ ì¢‹ìŠµë‹ˆê¹Œ? ì†”ì§í•˜ê²Œ ë§ì”€í•´ ë³´ì‹­ì‡¼.", reaction: { "ë¬´ë˜í•¨": { t2: "ë‘˜ ë‹¤ ì‚¬ëŒ ì¡ëŠ” ê±´ ë˜‘ê°™ì§€ ë­.", log: "ì²­ëª…ì´ ê²€ë‚ ì„ ë‹¦ìœ¼ë©° ëŒ€ë‹µí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë‹¹ì—°íˆ ë„¤ ì–¼êµ´ì´ ì œì¼ ì¢‹ì§€, ì„ë§ˆ!", log: "ì²­ëª…ì´ ìœ™í¬ë¥¼ ë‚ ë¦½ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ê²€ì€ ë‚´ ëª©ìˆ¨ì´ë‹¤. ë„Œ ë‚´... ì•„ë‹ˆë‹¤, ëë‹¤.", log: "ì²­ëª…ì´ ë§ì„ íë¦¬ë©° ì‘¥ìŠ¤ëŸ¬ì›Œí•©ë‹ˆë‹¤." } } },
                { t1: "{í˜¸ì¹­}, ì € ë§ê³  ë‹¤ë¥¸ ë†ˆì´ë‘ ìˆ  ë§ˆì‹œê¸°ë§Œ í•´ë³´ì‹­ì‡¼. ì‚¬ì²œì˜ ë…ì„ ë‹¤ í’€ ê²ë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ìˆ  ë§ˆì‹œëŠ”ë° ë…ì€ ì™œ í’€ì–´. ë¬´ì„­ê²Œ.", log: "ì²­ëª…ì´ ì”ì„ ì±„ìš°ë©° ë¬´ì‹¬í•˜ê²Œ ë§í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì˜¤~ ë¬´ì„œì›Œë¼. ê·¸ëŸ¼ ë„¤ê°€ ë§¤ì¼ ìˆ  ì‚¬ì¤„ ê±°ì•¼?", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì–´ê¹¨ì— íŒ”ì„ ì˜¬ë¦½ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "í˜‘ë°•ì´ëƒ? ë‚œ ë„ˆ ì—†ìœ¼ë©´ ìˆ ë§› ì•ˆ ë‚˜ê±°ë“ ?", log: "ì²­ëª…ì´ íˆ´íˆ´ê±°ë¦¬ë©° ë‹¹ë³´ì˜ ì”ì„ ì±„ì›ë‹ˆë‹¤." } } },
                { t1: "{í˜¸ì¹­} ì™œ ì €í•œí…Œë§Œ ê¹Œì¹ í•˜ê²Œ êµ¬ì‹œëŠ” ê²ë‹ˆê¹Œ? ë”´ ë†ˆë“¤í•œí… ì˜ ì›ƒì–´ì£¼ë©´ì„œ!", reaction: { "ë¬´ë˜í•¨": { t2: "ë‚´ê°€ ì–¸ì œ? ì°©ê°ì´ë‹¤.", log: "ì²­ëª…ì´ ë©í•œ í‘œì •ìœ¼ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ê°€ê¹Œìš°ë‹ˆê¹Œ í¸í•´ì„œ ê·¸ë ‡ì§€. ì´ ë°”ë³´ì•¼.", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ëº¨ì„ ì‚´ì§ ê¼¬ì§‘ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë„¤ê°€ í•˜ë„ ë¶™ì–´ë‹¤ë‹ˆë‹ˆê¹Œ ìˆ¨ì´ ë§‰í˜€ì„œ ê·¸ë˜!", log: "ì²­ëª…ì´ ê´œíˆ í°ì†Œë¦¬ë¥¼ ì¹©ë‹ˆë‹¤." } } },
                { t1: "ì˜¤ëŠ˜ë”°ë¼ ì˜·ì°¨ë¦¼ì´ ë„ˆë¬´ ê¹”ë”í•˜ì‹œêµ°ìš”. ëˆ„êµ¬ ë³´ì—¬ì£¼ë ¤ê³  ê¾¸ë¯¸ì‹  ê²ë‹ˆê¹Œ?", reaction: { "ë¬´ë˜í•¨": { t2: "ë¹¨ë˜ê°€ ì´ê²ƒë°–ì— ì—†ì–´ì„œ ì…ì—ˆë‹¤.", log: "ì²­ëª…ì´ ì˜· ë§¤ë¬´ìƒˆë¥¼ ëŒ€ì¶© ì •ë¦¬í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë„ˆ ë³´ì—¬ì£¼ë ¤ê³  ì…ì—ˆì§€. ì–´ë•Œ, ë°˜í–ˆëƒ?", log: "ì²­ëª…ì´ í•œ ë°”í€´ ëŒë©° í¬ì¦ˆë¥¼ ì·¨í•©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì•„ë¬´ë„ ì•ˆ ë³´ì—¬ì¤„ ê±°ë‹ˆê¹Œ ë„ˆë§Œ ë´ë¼. ëëƒ?", log: "ì²­ëª…ì´ ì–¼êµ´ì´ ë¶‰ì–´ì§„ ì±„ ì˜ì•„ë¶™ì…ë‹ˆë‹¤." } } }
            ],
            "ë¬´ë˜í•¨": [
                { t1: "{í˜¸ì¹­}, ìˆ˜ë ¨ë„ ì¢‹ì§€ë§Œ ê°€ë”ì€ ì¢€ ì‰¬ë©´ì„œ í•˜ì‹­ì‹œì˜¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ì˜¤ëƒ. ì•ˆ ê·¸ë˜ë„ ê·¸ëŸ¬ë ¤ë˜ ì°¸ì´ë‹¤.", log: "ë‘ ì‚¬ëŒì´ ë‚˜ë€íˆ ì•‰ì•„ ë•€ì„ ì‹í™ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ê±±ì •í•´ì£¼ëŠ” ê±°ëƒ? ì—­ì‹œ ìš°ë¦¬ ì•„ìš°ë°–ì— ì—†ë„¤!", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì–´ê¹¨ë¥¼ íˆ­ ì¹˜ë©° ì›ƒìŠµë‹ˆë‹¤." }, "ê¹Œì¹ í•¨": { t2: "ì”ì†Œë¦¬ ë§ˆë¼. ë„¤ ë¹„ë„ë‚˜ ë” ë‹¦ì•„ë†”.", log: "ì²­ëª…ì´ ì¸¤ì¸¤ê±°ë¦¬ë©° ë‹¤ì‹œ ê²€ì„ íœ˜ë‘ë¦…ë‹ˆë‹¤." } } },
                { t1: "í•´ê°€ ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì´ë§Œ ë“¤ì–´ê°ˆê¹Œìš”?", reaction: { "ë¬´ë˜í•¨": { t2: "ê·¸ë˜, ê°€ì. ë°°ê³ í”„ë„¤.", log: "ë‘ ì‚¬ëŒì´ ë…¸ì„ì„ ë’¤ë¡œí•˜ê³  ìˆ™ì†Œë¡œ í–¥í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë²Œì¨? ë°¤ìƒˆë„ë¡ ë‚˜ë‘ ë†€ì•„ì¤˜ì•¼ì§€!", log: "ì²­ëª…ì´ ì•„ì‰¬ìš´ ë“¯ ë‹¹ë³´ì˜ ì†Œë§¤ë¥¼ ë¶™ì¡ìŠµë‹ˆë‹¤." }, "ê¹Œì¹ í•¨": { t2: "ê°€ê³  ì‹¶ìœ¼ë©´ ë„ˆë‚˜ ê°€. ë‚œ ë” í•  ê±°ë‹¤.", log: "ì²­ëª…ì´ ê³ ì§‘ì„ ë¶€ë¦¬ë©° ìë¦¬ë¥¼ ì§€í‚µë‹ˆë‹¤." } } },
                { t1: "ê¸¸ê°€ì— ê½ƒì´ íˆë”êµ°ìš”. {í˜¸ì¹­} ì¢‹ì•„í•˜ì‹¤ ê²ƒ ê°™ì•„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ê½ƒ? ê³ ë§™ë‹¤. ë°©ì— ë‘ë§ˆ.", log: "ì²­ëª…ì´ ë¬´ì‹¬í•˜ê²Œ ê½ƒì„ ë°›ì•„ë“­ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì•„ì´ê³ ~ ìš°ë¦¬ ë‹¹ë³´ê°€ ì›¬ì¼ë¡œ ì´ëŸ° ê½ƒ ì„ ë¬¼ì„?", log: "ì²­ëª…ì´ ê½ƒí–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ì¥ë‚œìŠ¤ëŸ½ê²Œ ì›ƒìŠµë‹ˆë‹¤." }, "ê¹Œì¹ í•¨": { t2: "ë‚´ê°€ ë¬´ìŠ¨ ê³„ì§‘ì• ëƒ? ê½ƒì€ ë¬´ìŠ¨...", log: "ì²­ëª…ì´ íˆ¬ëœëŒ€ë©´ì„œë„ ê½ƒì„ ë²„ë¦¬ì§€ ì•Šê³  ì±™ê¹ë‹ˆë‹¤." } } },
                { t1: "ì‚¬ì²œì—ì„œ ì„œì‹ ì´ ì™”ìŠµë‹ˆë‹¤. ë‹¹ê°€ ë†ˆë“¤ì´ {í˜¸ì¹­} ì•ˆë¶€ë¥¼ ë¬»ë”êµ°ìš”.", reaction: { "ë¬´ë˜í•¨": { t2: "ë‚˜ì•¼ ì˜ ìˆì§€. ê±”ë“¤ë„ ì˜ ì§€ë‚´ë¼ê³  ì „í•´ë¼.", log: "ì²­ëª…ì´ ì„œì‹  ë‚´ìš©ì„ ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë“£ìŠµë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë‚´ ì¸ê¸°ê°€ ì‚¬ì²œê¹Œì§€ ë»—ì¹œ ëª¨ì–‘ì´ë„¤? ã…‹ã…‹", log: "ì²­ëª…ì´ ê¸°ë¶„ ì¢‹ê²Œ ì½§ë…¸ë˜ë¥¼ ë¶€ë¦…ë‹ˆë‹¤." }, "ê¹Œì¹ í•¨": { t2: "ê·€ì°®ê²Œ ì‹œë¦¬... ê·¸ë†ˆë“¤ì€ ì™œ ìê¾¸ ë‚´ ì•ˆë¶€ë¥¼ ë¬¼ì–´?", log: "ì²­ëª…ì´ ì¸ìƒì„ ì“°ë©´ì„œë„ ì‹«ì§€ ì•Šì€ ê¸°ìƒ‰ì…ë‹ˆë‹¤." } } },
                { t1: "{í˜¸ì¹­}, ì˜·ì´ ì¢€ ëœ¯ì–´ì¡ŒìŠµë‹ˆë‹¤. ì´ë¦¬ ì£¼ì‹­ì‹œì˜¤. ì œê°€ ê¿°ë§¤ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ì•„, ê³ ë§™ë‹¤. ì†ì¬ì£¼ê°€ ì¢‹ë„¤.", log: "ë‹¹ë³´ê°€ ì†œì”¨ ì¢‹ê²Œ ì˜·ì„ ìˆ˜ì„ í•˜ëŠ” ê²ƒì„ ì§€ì¼œë´…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ìš°ë¦¬ ì•„ìš°, ë‚˜ì¤‘ì— ì‹œì§‘ê°€ë„ ë˜ê² ì–´?", log: "ì²­ëª…ì´ ë‚„ë‚„ê±°ë¦¬ë©° ë‹¹ë³´ë¥¼ ë†€ë¦½ë‹ˆë‹¤." }, "ê¹Œì¹ í•¨": { t2: "ê·¸ëƒ¥ ë‘¬ë¼. ì´ëŸ° ê±° ì…ëŠ”ë‹¤ê³  ì•ˆ ì£½ëŠ”ë‹¤.", log: "ì²­ëª…ì´ ë¯¼ë§í•œ ë“¯ ì˜·ìë½ì„ ì—¬ë°‰ë‹ˆë‹¤." } } }
            ]
        },
        "chung_start": {
            "ëŠ¥ê¸€ë§ìŒ": [
                { t1: "ì•¼, ë‹¹ë³´ì•¼. ë„ˆ ì˜¤ëŠ˜ë”°ë¼ ì™œ ì´ë ‡ê²Œ ì˜ìƒê²¨ ë³´ì´ëƒ? ë­ ì˜ëª» ë¨¹ì—ˆì–´?", reaction: { "ë¬´ë˜í•¨": { t2: "ì›ë˜ ì´ë¬ìŠµë‹ˆë‹¤. ì´ì œì•¼ ì•Œì•„ë³´ì‹  ê²ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ ë¤ë¤í•˜ê²Œ ëŒ€ë‹µí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "{í˜¸ì¹­} ëˆˆì— ì œê°€ ë“œë””ì–´ ê½ƒìœ¼ë¡œ ë³´ì´ì‹œëŠ” ëª¨ì–‘ì…ë‹ˆë‹¤?", log: "ë‹¹ë³´ê°€ í•œìˆ  ë” ë– ì„œ ë„ˆìŠ¤ë ˆë¥¼ ë–±ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ê°‘ìê¸° ê·¸ëŸ° ì†Œë¦° ì™œ í•˜ì‹­ë‹ˆê¹Œ? ë”´ ë†ˆí•œí…Œë„ í•˜ì…¨ì£ ?", log: "ë‹¹ë³´ê°€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ëˆˆì´ˆë¦¬ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤." } } },
                { t1: "ì‚¬ì²œë‹¹ê°€ì— ëˆ ë§ë‹¤ë©°? ì´ {í˜¸ì¹­} ìš©ëˆ ì¢€ ì£¼ë¼. ì‘?", reaction: { "ë¬´ë˜í•¨": { t2: "ëˆ ê´€ë¦¬ì¸ì€ ë”°ë¡œ ìˆìŠµë‹ˆë‹¤. ì œ ë§˜ëŒ€ë¡œ ì•ˆ ë©ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ë‹¨í˜¸í•˜ê²Œ ê±°ì ˆí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì œ ì§€ê°‘ì€ {í˜¸ì¹­} ê±°ë‚˜ ë‹¤ë¦„ì—†ì£ . ëŒ€ì‹  ì˜¤ëŠ˜ ì €ë‘ ìˆ  í•œì” ì–´ë– ì‹­ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ìˆ  ì•½ì†ì„ ì¡ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ëˆ í•„ìš”í•  ë•Œë§Œ ì•„ìš° ì°¾ìœ¼ì‹œì§€, ì•„ì£¼.", log: "ë‹¹ë³´ê°€ ì„œìš´í•œ ë“¯ ì…ìˆ ì„ ë‚´ë°‰ë‹ˆë‹¤." } } },
                { t1: "ì•¼, ë„¤ê°€ ê·¸ë ‡ê²Œ ë¬´ì‹œë¬´ì‹œí•œ ì•”ì¡´ì´ë¼ë©°? ë‚´ ì•ì—ì„œëŠ” ê·¸ëƒ¥ ê°•ì•„ì§€ ê°™ì€ë°?", reaction: { "ë¬´ë˜í•¨": { t2: "{í˜¸ì¹­} ì•ì—ì„œë§Œ ì´ëŸ¬ëŠ” ê²ë‹ˆë‹¤. ë”´ ë°ì„  ì•ˆ ì´ë˜ìš”.", log: "ë‹¹ë³´ê°€ ì‘¥ìŠ¤ëŸ¬ìš´ ë“¯ ê³ ê°œë¥¼ ëŒë¦½ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì™ˆì™ˆ! ëìŠµë‹ˆê¹Œ? ì´ì œ ì“°ë‹¤ë“¬ì–´ ì£¼ì‹œì£ .", log: "ë‹¹ë³´ê°€ ì¥ë‚œìŠ¤ëŸ½ê²Œ ë¨¸ë¦¬ë¥¼ ë‚´ë°‰ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ê°•ì•„ì§€ ì·¨ê¸‰í•˜ì§€ ë§ˆì‹­ì‡¼. ì €ë„ ë‚¨ìì…ë‹ˆë‹¤!", log: "ë‹¹ë³´ê°€ ê´œíˆ ëª©ì†Œë¦¬ë¥¼ ë†’ì…ë‹ˆë‹¤." } } },
                { t1: "ë„ˆ ì—†ìœ¼ë‹ˆê¹Œ ì‹¬ì‹¬í•´ ì£½ëŠ” ì¤„ ì•Œì•˜ë‹¤. ì–´ë”” ê°€ì„œ ëˆ„êµ¬ë‘ ë†€ë‹¤ ì˜¨ ê±°ì•¼?", reaction: { "ë¬´ë˜í•¨": { t2: "ì ì‹œ ë³¼ì¼ ì¢€ ë³´ê³  ì™”ìŠµë‹ˆë‹¤. ë³„ê±° ì•„ë‹™ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ì°¨ë¶„í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–´ë¨¸, {í˜¸ì¹­}. ì € ì—†ìœ¼ë©´ ì•ˆ ë˜ëŠ” ëª¸ì´ ë˜ì‹  ê²ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ ê°ë™ë°›ì€ ì²™ í˜¸ë“¤ê°‘ì„ ë–±ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­}ì•¼ë§ë¡œ ì•„ê¹Œ ê·¸ ë„ì‚¬ë†ˆì´ë‘ ì›ƒê³  ê³„ì‹œë˜ë°ìš”?", log: "ë‹¹ë³´ê°€ ì—­ê³µì„ í¼ì¹©ë‹ˆë‹¤." } } },
                { t1: "ë‚˜ ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì¢€ ì•ˆ ì¢‹ì€ë°, ë„¤ê°€ ì¬ë¡± ì¢€ ë–¨ì–´ë´ë¼. ê·¸ëŸ¼ í’€ë¦´ ê²ƒ ê°™ì•„.", reaction: { "ë¬´ë˜í•¨": { t2: "...ì œê°€ ë¬´ìŠ¨ ê´‘ëŒ€ì¸ ì¤„ ì•„ì‹­ë‹ˆê¹Œ.", log: "ë‹¹ë³´ê°€ ì–´ì´ì—†ë‹¤ëŠ” ë“¯ ì³ë‹¤ë´…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì¬ë¡±ì€ ë¬´ìŠ¨... ê·¸ëƒ¥ ì œê°€ ì•ˆì•„ ë“œë¦´ê¹Œìš”?", log: "ë‹¹ë³´ê°€ íŒ”ì„ ë²Œë¦¬ë©° ë‹¤ê°€ì˜µë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì•„ë¬´í•œí…Œë‚˜ ì¬ë¡± í”¼ìš°ë¼ í•˜ê³ ... {í˜¸ì¹­} ì •ë§ ë„ˆë¬´í•˜ì‹­ë‹ˆë‹¤!", log: "ë‹¹ë³´ê°€ ì§„ì§œë¡œ ì‚ì§„ ê¸°ìƒ‰ì„ ë³´ì…ë‹ˆë‹¤." } } }
            ],
            "ë¬´ë˜í•¨": [
                { t1: "ì•¼ ë‹¹ë³´ì•¼, ë°°ê³ í”„ë‹¤. ë­ ë¨¹ì„ ê±° ì—†ëƒ?", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "{í˜¸ì¹­} ë“œì‹œë¼ê³  ë§Œë‘ ì‚¬ì™”ì£ . ì, ì•„~ í•˜ì‹­ì‡¼.", log: "ë‹¹ë³´ê°€ ë§Œë‘ë¥¼ í•˜ë‚˜ ì§‘ì–´ ì…ì— ë„£ì–´ì¤ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ë¶€ì—Œì— ê°€ë³´ì‹­ì‡¼. êµ­ìˆ˜ë¼ë„ ì‚¶ì•„ ë“œë¦´ê¹Œìš”?", log: "ë‹¹ë³´ê°€ ì¼ì–´ì„œì„œ ì•ì¹˜ë§ˆë¥¼ ë‘ë¦…ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë§Œë‘ê°€ ì¢‹ìŠµë‹ˆê¹Œ, ì œê°€ ì¢‹ìŠµë‹ˆê¹Œ? ê³¨ë¼ë³´ì‹­ì‡¼.", log: "ë‹¹ë³´ê°€ ë§Œë‘ ì ‘ì‹œë¥¼ ìˆ¨ê¸°ë©° ë¬»ìŠµë‹ˆë‹¤." } } },
                { t1: "ì˜¤ëŠ˜ë”°ë¼ ë¹„ë„ê°€ ì°¸ ë²ˆì©ê±°ë¦¬ë„¤. ê´€ë¦¬ ì¢€ í–ˆëƒ?", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "{í˜¸ì¹­} ì‹¬ì¥ ê¿°ëš«ìœ¼ë ¤ê³  ë°¤ìƒˆ ë‹¦ì•˜ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ë¹„ë„ë¥¼ ëŒë¦¬ë©° ì”© ì›ƒìŠµë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ë¬´ê¸° ê´€ë¦¬ëŠ” ê¸°ë³¸ì´ì£ . {í˜¸ì¹­} ê²€ë„ ë‹¦ì•„ë“œë¦´ê¹Œìš”?", log: "ë‹¹ë³´ê°€ ë§ˆë¥¸ í—ê²Šì„ êº¼ëƒ…ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­} ì•ˆ ë´ì£¼ì‹œë‹ˆê¹Œ ë¹„ë„ë¼ë„ ë´ë‹¬ë¼ê³  ë‹¦ì•˜ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ì„­ì„­í•œ íˆ¬ë¡œ ë§í•©ë‹ˆë‹¤." } } },
                { t1: "ì¡¸ë¦¬ë‹¤... ë‚˜ ì¢€ ì˜ í…Œë‹ˆê¹Œ ê¹¨ìš°ì§€ ë§ˆë¼.", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ì œ ë¬´ë¦ ë¹Œë ¤ë“œë¦´ê¹Œìš”? ì•„ì£¼ í¸í•  í…ë°.", log: "ë‹¹ë³´ê°€ ìì‹ ì˜ í—ˆë²…ì§€ë¥¼ í†¡í†¡ ì¹©ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ì˜ˆ, í•œìˆ¨ ì£¼ë¬´ì‹­ì‡¼. ê·¼ì²˜ëŠ” ì œê°€ ì§€í‚¤ê² ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ê°€ë§Œíˆ ì˜†ì— ì•‰ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ìëŠ” ë™ì•ˆ ë”´ ë†ˆ ì´ë¦„ ë¶€ë¥´ê¸°ë§Œ í•´ë³´ì‹­ì‡¼.", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì´ë¶ˆì„ ê¼¼ê¼¼íˆ ë®ì–´ì£¼ë©° ì¤‘ì–¼ê±°ë¦½ë‹ˆë‹¤." } } },
                { t1: "ë§¤í™”ê°€ íˆë„¤. ìˆ  ë§ˆì‹œê¸° ì¢‹ì€ ë‚ ì´ë‹¤.", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ê½ƒë³´ë‹¤ {í˜¸ì¹­} ë” ì•„ë¦„ë‹¤ìš°ì‹  ê²Œ ë¬¸ì œì£ .", log: "ë‹¹ë³´ê°€ ê½ƒê°€ë£¨ë¥¼ í„¸ì–´ì£¼ë©° ë§í•©ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ê·¸ëŸ¬ê²Œ ë§ì…ë‹ˆë‹¤. ìˆ ìƒ ë´ì˜¤ê² ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ë¶€ì§€ëŸ°íˆ ì›€ì§ì…ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ê½ƒ ë³´ëŠë¼ ì € ì•ˆ ë³´ì‹œëŠ” ê±° ì•„ë‹ˆì£ ?", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì‹œì„ ì„ ê°€ë¡œë§‰ìŠµë‹ˆë‹¤." } } },
                { t1: "ë„ˆ ìš”ì¦˜ ì™œ ì´ë ‡ê²Œ ì¡°ìš©í•˜ëƒ? ì–´ë”” ì•„í”ˆ ê±° ì•„ëƒ?", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "{í˜¸ì¹­} ê±±ì •í•´ ì£¼ì‹œë‹ˆê¹Œ ê°‘ìê¸° ë‹¤ ë‚˜ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤!", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì†ì„ ë¥ì„ ì¡ìŠµë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ê·¸ëƒ¥ ìƒê°í•  ê²Œ ì¢€ ìˆì–´ì„œ ê·¸ë ‡ìŠµë‹ˆë‹¤. ë©€ì©¡í•©ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ì‚´ì§ ë¯¸ì†Œ ì§“ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­} ë‹¤ë¥¸ ë†ˆë“¤ì´ë‘ë§Œ ë…¸ë‹ˆê¹Œ ê¸°ìš´ì´ ì•ˆ ë‚˜ì£ !", log: "ë‹¹ë³´ê°€ ì…ìˆ ì„ ì‚ì£½ ë‚´ë°‰ë‹ˆë‹¤." } } }
            ],
            "ì§ˆíˆ¬ë§ìŒ": [
                { t1: "ì•¼, ë‹¹ë³´. ë„ˆ ì•„ê¹Œ ê·¸ ì‚¬ì²œì—ì„œ ì˜¨ ë†ˆì´ë‘ ë­ê°€ ê·¸ë ‡ê²Œ ì¦ê±°ì›Œ ë³´ì´ë”ë¼?", reaction: { "ë¬´ë˜í•¨": { t2: "ê°€ë¬¸ ì†Œì‹ì„ ì „í•´ ë“¤ì—ˆì„ ë¿ì…ë‹ˆë‹¤. ë³„ì¼ ì•„ë‹™ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ í‰ì˜¨í•˜ê²Œ ëŒ€ë‹µí•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì™œìš”? ì œê°€ ë”´ ë†ˆì´ë‘ ë…¸ë‹ˆê¹Œ ë°° ì•„í”„ì‹­ë‹ˆê¹Œ? ã…‹ã…‹", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì§ˆíˆ¬ë¥¼ ì¦ê¸°ë©° ì›ƒìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì €ë„ {í˜¸ì¹­} ë‹¤ë¥¸ ì œìë“¤ì´ë‘ ë¶™ì–´ ìˆëŠ” ê±° ë³´ê¸° ì‹«ê±°ë“ ìš”!", log: "ë‘ ì‚¬ëŒ ì‚¬ì´ì— ë¶ˆê½ƒ íŠ€ëŠ” ì‹ ê²½ì „ì´ ë²Œì–´ì§‘ë‹ˆë‹¤." } } },
                { t1: "ë¹„ë„ ê´€ë¦¬ë¥¼ ê·¸ë ‡ê²Œ ì—´ì‹¬íˆ í•  ê±°ë©´ ë‚´ ê²€ë„ ì¢€ ë´ì£¼ì§€ ê·¸ë˜? ì •ì„±ì´ë‹¤ ì •ì„±.", reaction: { "ë¬´ë˜í•¨": { t2: "ì´ë¦¬ ì£¼ì‹­ì‹œì˜¤. ê°™ì´ ë‹¦ì•„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ìˆœìˆœíˆ ì²­ëª…ì˜ ê²€ì„ ë°›ì•„ë“­ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ë¹„ë„ëŠ” ì œ ë¶„ì‹ ì´ë‚˜ ë‹¤ë¦„ì—†ê±°ë“ ìš”. {í˜¸ì¹­}ì²˜ëŸ¼ìš”.", log: "ë‹¹ë³´ê°€ ëŠë¼í•œ ë©˜íŠ¸ë¥¼ ë‚ ë¦½ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë¹„ë„ëŠ” ë„êµ¬ì¼ ë¿ì´ì§€ë§Œ {í˜¸ì¹­}... ì—íœ´, ë§ì„ ë§™ì‹œë‹¤.", log: "ë‹¹ë³´ê°€ í•œìˆ¨ì„ ì‰¬ë©° ê³ ê°œë¥¼ ì “ìŠµë‹ˆë‹¤." } } },
                { t1: "ë„ˆ ìš”ì¦˜ ìê¾¸ ë‚˜ ëª°ë˜ ì–´ë”” ë‚˜ê°€ëŠ” ê²ƒ ê°™ë‹¤? ìˆ˜ìƒí•´.", reaction: { "ë¬´ë˜í•¨": { t2: "{í˜¸ì¹­} ë“œë¦´ ìˆ  ì‚¬ëŸ¬ ê°”ë˜ ê²ë‹ˆë‹¤. ì—¬ê¸° ìˆìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ í’ˆ ì•ˆì—ì„œ ìˆ ë³‘ì„ êº¼ëƒ…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì˜¤~ ì €ë¥¼ ê·¸ë ‡ê²Œ ì§€ì¼œë³´ê³  ê³„ì…¨ë˜ ê²ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ ë¶€ë„ëŸ¬ì›Œí•˜ëŠ” ì²™ ì—°ê¸°í•©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­} ì € ì•ˆ ë´ì£¼ì‹œë‹ˆê¹Œ ì €ë„ ì œ ê°ˆ ê¸¸ ì°¾ëŠ” ê±°ì£ !", log: "ë‹¹ë³´ê°€ í™§ê¹€ì— ì•„ë¬´ ë§ì´ë‚˜ ë‚´ë±‰ìŠµë‹ˆë‹¤." } } },
                { t1: "ë‹¤ë¥¸ ë†ˆë“¤ì´ ë„ˆë³´ê³  ëŒ€ë‹¨í•œ ì•”ì¡´ì´ë¼ê³  ë– ë“œëŠ” ê±° ë³´ë‹ˆê¹Œ ì°¸ ì›ƒê¸°ì§€ë„ ì•Šë”ë¼.", reaction: { "ë¬´ë˜í•¨": { t2: "ê·¸ëƒ¥ í•˜ëŠ” ì†Œë¦¬ë“¤ì´ì£ . ì‹ ê²½ ì“°ì§€ ë§ˆì‹­ì‹œì˜¤.", log: "ë‹¹ë³´ê°€ ë¬´ì‹¬í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì§ˆíˆ¬í•˜ëŠ” {í˜¸ì¹­} ëª¨ìŠµì´ ë” ì›ƒê¸´ë°ìš”? ê·€ì—½ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ì²­ëª…ì„ ë†€ë¦¬ë©° ì›ƒìŒì„ í„°ëœ¨ë¦½ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­}í•œí…Œë§Œ ì¸ì •ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤. ë”´ ë†ˆë“¤ì€ ìƒê´€ì—†ì–´ìš”.", log: "ë‹¹ë³´ê°€ ì§„ì§€í•œ ëˆˆë¹›ìœ¼ë¡œ ì²­ëª…ì„ ë´…ë‹ˆë‹¤." } } },
                { t1: "ì•¼... ë„ˆ, ê·¸... ì•„ê¹Œ ì›ƒì–´ì¤€ ê±°. ê·¸ê±° ë‚˜í•œí…Œë§Œ í•´ë¼. ë”´ ë†ˆë“¤í•œí…Œ í˜ë¦¬ê³  ë‹¤ë‹ˆì§€ ë§ê³ .", reaction: { "ë¬´ë˜í•¨": { t2: "...ì˜ˆ? ì•„, ì•Œê² ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ë‹¹í™©í•˜ë©° ê³ ê°œë¥¼ ë„ë•ì…ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–´ë¨¸ë‚˜, {í˜¸ì¹­} ì§€ê¸ˆ ì†Œìœ ìš• ë¶€ë¦¬ì‹œëŠ” ê²ë‹ˆê¹Œ? ì–´ë–¡í•´~", log: "ë‹¹ë³´ê°€ ì–¼êµ´ì„ ë¶‰íˆë©° ì¢‹ì•„í•©ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "{í˜¸ì¹­}ì•¼ë§ë¡œ ì•„ë¬´í•œí…Œë‚˜ ê·¸ë ‡ê²Œ í¼ì£¼ì§€ ë§ˆì‹­ì‡¼!", log: "ë‹¹ë³´ë„ ì§€ì§€ ì•Šê³  ë§ë°›ì•„ì¹©ë‹ˆë‹¤." } } }
            ]
        },
        "love_interaction": {
            "dangbo": {
                "ëŠ¥ê¸€ë§ìŒ": [
                    { t1: "í˜•ë‹˜, ì œ ì‹¬ì¥ ì†Œë¦¬ ë“¤ë¦¬ì‹­ë‹ˆê¹Œ? í˜•ë‹˜ë§Œ ë³´ë©´ ì•„ì£¼ ì¿µì¿µê±°ë ¤ ì£½ê² ìŠµë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ì‹¬ê³„ê°€ ë¶ˆì•ˆì •í•œ ê±°ëƒ? ì§„ë§¥ì´ë‚˜ í•´ë´ë¼.", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì†ëª©ì„ ì¡ìœ¼ë ¤ í•©ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–´ë”” ì–¼ë§ˆë‚˜ ë›°ë‚˜ ë³´ì. ë‚´ê°€ ë©ˆì¶”ê²Œ í•´ì¤„ê¹Œ?", log: "ì²­ëª…ì´ ì§“ê¶‚ê²Œ ë‹¹ë³´ì˜ ê°€ìŠ´ì— ì†ì„ ëŒ‘ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì‹œë„ëŸ¬ì›Œ. ë”´ ë†ˆ ì•ì—ì„œë„ ê·¸ë ‡ê²Œ ì‹¬ì¥ì´ ë›°ëƒ?", log: "ì²­ëª…ì´ ì¸ìƒì„ ì“°ë©° ê·€ë¥¼ ë§‰ìŠµë‹ˆë‹¤." } } },
                    { t1: "{í˜¸ì¹­}, ì €ë‘ í˜¼ì¸í•˜ì‹œì£ . ì‚¬ì²œë‹¹ê°€ë¥¼ ì§€ì°¸ê¸ˆìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ë‹¹ê°€ê°€ ë„¤ ê±°ëƒ? í—›ì†Œë¦¬ ë§ê³  ì ì´ë‚˜ ìë¼.", log: "ì²­ëª…ì´ ì–´ì´ì—†ë‹¤ëŠ” ë“¯ í˜€ë¥¼ ì°¹ë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ê²¨ìš° ë‹¹ê°€ í•˜ë‚˜ë¡œ? í™”ì‚° ì „ì²´ë¥¼ ì¤˜ë„ ëª¨ìë¼ì§€.", log: "ì²­ëª…ì´ ê±°ë“œë¦„ì„ í”¼ìš°ë©° ì›ƒìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "í˜¼ì¸ì´ ì¥ë‚œì´ëƒ? ...ê·¸ë˜ì„œ, ì–¸ì œ í•  ê±´ë°?", log: "ì²­ëª…ì´ ì–¼êµ´ì„ ë¶‰íˆë©° ë”´ì²­ì„ í”¼ì›ë‹ˆë‹¤." } } },
                    { t1: "ìˆ ë³´ë‹¤ {í˜¸ì¹­} í–¥ê¸°ê°€ ë” ì·¨í•˜ëŠ”êµ°ìš”. ì˜¤ëŠ˜ë”°ë¼ ìœ„í—˜í•˜ì‹­ë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ìˆ ì£¼ì •ë„ ê°€ì§€ê°€ì§€ë‹¤. ë‹¥ì¹˜ê³  ë§ˆì‹œê¸°ë‚˜ í•´.", log: "ì²­ëª…ì´ ìˆ ì”ì„ ë‹¹ë³´ ì…ì— ë°€ì–´ë„£ìŠµë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì·¨í•˜ë©´ ì±…ì„ì ¸ ì¤„ ê±°ëƒ? ë§ë§Œ í•˜ì§€ ë§ê³ .", log: "ì²­ëª…ì´ í„±ì„ê´´ê³  ë‹¹ë³´ë¥¼ ê·¸ìœ½í•˜ê²Œ ë´…ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "í—ˆíŠ¼ìˆ˜ì‘ ë¶€ë¦¬ì§€ ë§ˆë¼. ì˜¤ëŠ˜ ë‚´ ë°©ì—ì„œ ëª» ë‚˜ê°ˆ ì¤„ ì•Œì•„.", log: "ì²­ëª…ì´ ë°©ë¬¸ì„ ì ê·¸ëŠ” ì‹œëŠ‰ì„ í•©ë‹ˆë‹¤." } } }
                ],
                "ì§ˆíˆ¬ë§ìŒ": [
                    { t1: "ì•„ê¹Œ ê·¸ ë…€ì„ì´ {í˜¸ì¹­} ì³ë‹¤ë³´ëŠ” ëˆˆë¹›ì´ ë§˜ì— ì•ˆ ë“­ë‹ˆë‹¤. ëˆˆì„ ë½‘ì•„ë²„ë¦´ê¹Œìš”?", reaction: { "ë¬´ë˜í•¨": { t2: "ë˜ ì‹œì‘ì´ë„¤. ê·¸ëƒ¥ ì¢€ ëƒ…ë‘¬ë¼.", log: "ì²­ëª…ì´ ë‹¹ë³´ë¥¼ ì§„ì •ì‹œí‚µë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ì™œ, ë‚˜ ëºê¸¸ê¹Œ ë´ ê²ë‚˜ëƒ? ê·€ì—¬ìš´ ë…€ì„.", log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ë³¼ì„ ê¼¬ì§‘ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë‚˜ë„ ì•„ê¹Œ ë„¤ê°€ ë”´ ë†ˆí•œí…Œ ì›ƒì–´ì£¼ëŠ” ê±° ê±°ìŠ¬ë ¸ê±°ë“ ?", log: "ì„œë¡œì˜ ì§ˆíˆ¬ì‹¬ì´ í­ë°œí•©ë‹ˆë‹¤." } } },
                    { t1: "{í˜¸ì¹­}ì€ ì œ ê²ë‹ˆë‹¤. ë¨¸ë¦¬ì¹´ë½ í•œ ì˜¬ë„ ë‚¨í•œí…Œ ëª» ì¤ë‹ˆë‹¤.", reaction: { "ë¬´ë˜í•¨": { t2: "ì´ê²Œ ì›¬ ì§‘ì°©ì´ì•¼... ì•Œì•˜ë‹¤, ì•Œì•˜ì–´.", log: "ì²­ëª…ì´ ì§ˆë¦°ë‹¤ëŠ” í‘œì •ì„ ì§“ìŠµë‹ˆë‹¤." }, "ëŠ¥ê¸€ë§ìŒ": { t2: "ê·¸ë˜, ë‹¤ ë„¤ ê±°ë‹¤. ì´ì œ ë§Œì¡±í•˜ëƒ?", log: "ì²­ëª…ì´ ë‹¹ë³´ë¥¼ ëŒì–´ì•ˆì•„ ì¤ë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë‹¹ì—°í•œ ì†Œë¦´. ë„ˆë„ ë‚´ ê±°ë‹ˆê¹Œ ì–´ë”” ê°€ì§€ ë§ˆ.", log: "ì†Œìœ ìš•ì´ ë¶ˆíƒ€ì˜¤ë¦…ë‹ˆë‹¤." } } }
                ]
            },
            "chung": {
                "ë¬´ë˜í•¨": [
                    { t1: "ì•¼. ...ì•„ë‹ˆ, ê·¸ëƒ¥. ì–¼êµ´ ì¢€ ë³´ìê³ . ì´ë¦¬ ì™€ ë´.", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ì œ ì–¼êµ´ì´ ê·¸ë ‡ê²Œ ì¢‹ìœ¼ì‹­ë‹ˆê¹Œ? ë‹³ê² ìŠµë‹ˆë‹¤, í˜•ë‹˜.", log: "ë‹¹ë³´ê°€ ì–¼êµ´ì„ ê°€ê¹Œì´ ë“¤ì´ë°‰ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ê°‘ìê¸° ì™œ ê·¸ëŸ¬ì‹­ë‹ˆê¹Œ? ì–´ë”” ì•„í”„ì‹­ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì´ë§ˆë¥¼ ì§šìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ë”´ ë†ˆ ë³´ì§€ ë§ê³  ì €ë§Œ ë³´ì‹­ì‡¼. í‰ìƒ.", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì‹œì„ ì„ ê³ ì •ì‹œí‚µë‹ˆë‹¤." } } },
                    { t1: "ë„ˆ ì˜¤ëŠ˜ë”°ë¼ ìœ ë… ê±°ìŠ¬ë¦¬ë„¤. ...ë‚´ ì˜†ì— ë”± ë¶™ì–´ ìˆì–´ë¼. ë–¨ì–´ì§€ì§€ ë§ê³ .", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–´ë¨¸, í˜•ë‹˜. ì € ë†“ì¹ ê¹Œ ë´ ë¬´ì„œìš°ì‹­ë‹ˆê¹Œ?", log: "ë‹¹ë³´ê°€ íŒ”ì§±ì„ ë‚ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ì˜ˆ, í˜•ë‹˜ ê»Œë”±ì§€ì²˜ëŸ¼ ë¶™ì–´ ìˆê² ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ìˆœìˆœíˆ ì˜†ì— ì•‰ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ëª…ë ¹ ì•ˆ í•˜ì…”ë„ ì°°ê°€ë¨¸ë¦¬ì²˜ëŸ¼ ë¶™ì–´ìˆì„ ê²ë‹ˆë‹¤!", log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì˜·ìë½ì„ ê½‰ ì¥¡ë‹ˆë‹¤." } } },
                    { t1: "ì† ì¤˜ë´. ...ì°¨ê°€ìš°ë‹ˆê¹Œ ì¡ê³  ìˆìœ¼ë¼ê³ . ë³„ëœ» ì—†ë‹¤.", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–¼êµ´ì€ í™ì‹œê°€ ë¼ì„œ ë³„ëœ» ì—†ìœ¼ì‹œë‹µë‹ˆë‹¤~", log: "ë‹¹ë³´ê°€ ê¹ì§€ë¥¼ ë‚ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "í˜•ë‹˜ ì†ì´ ë” ë”°ëœ»í•˜êµ°ìš”. ì¢‹ìŠµë‹ˆë‹¤.", log: "ë‘ ì‚¬ëŒì´ ì†ì„ ì¡ê³  ê±·ìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì´ ì† ì ˆëŒ€ ë†“ì§€ ë§ˆì‹­ì‡¼. ë†“ìœ¼ë©´ ë­…ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ì†ì„ ê½‰ ì¡ìŠµë‹ˆë‹¤." } } }
                ],
                "ëŠ¥ê¸€ë§ìŒ": [
                    { t1: "ë‹¹ë³´ì•¼, ë„ˆ ì˜¤ëŠ˜ ì¢€ ë§›ìˆê²Œ ìƒê²¼ë‹¤? í•œì…ë§Œ ë¨¹ì.", reaction: { "ëŠ¥ê¸€ë§ìŒ": { t2: "ì–´ë¨¸ í˜•ë‹˜ë„ ì°¸, ë°¤ì— ë“œì…”ì•¼ì£ . ì§€ê¸ˆì€ ëŒ€ë‚®ì…ë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ìœ™í¬ë¥¼ ë‚ ë¦½ë‹ˆë‹¤." }, "ë¬´ë˜í•¨": { t2: "ì œê°€ ìŒì‹ì…ë‹ˆê¹Œ? í—›ì†Œë¦¬ ë§ˆì‹­ì‡¼.", log: "ë‹¹ë³´ê°€ ì •ìƒ‰í•˜ì§€ë§Œ ê·€ëŠ” ë¹¨ê°œì¡ŒìŠµë‹ˆë‹¤." }, "ì§ˆíˆ¬ë§ìŒ": { t2: "ì €ë§Œ ë“œì…”ì•¼ í•©ë‹ˆë‹¤? ë”´ ë†ˆ ë§›ë³´ë©´ ì£½ìŠµë‹ˆë‹¤.", log: "ë‹¹ë³´ê°€ ëª©ì„ ë‚´ì–´ì¤ë‹ˆë‹¤." } } }
                ]
            }
        },
        "solo": {
            dangbo: ["{í˜¸ì¹­}ì€ ì˜¤ëŠ˜ë„ ê¸°ìš´ì´ ë„˜ì¹˜ì‹œëŠ”êµ°.", "ë…ì„ ì¢€ ë” ê°œëŸ‰í•´ë³¼ê¹Œ...", "ë¹„ë„ ë‹¦ê¸° ì¢‹ì€ ë‚ ì”¨ë‹¤."],
            chung: ["ì•„ì˜¤, ì‚­ì‹ ì´ì•¼.", "ë‹¹ê³¼ê°€ ë‹¤ ë–¨ì–´ì¡ŒëŠ”ë°...", "ìˆ  ê°€ì ¸ì™€, ìˆ !"]
        }
    };

    // ================= 3. ì „ì—­ ë³€ìˆ˜ ë° ì‹œê°„ ì‹œìŠ¤í…œ =================
    let currentUserId = 'dangbo';
    let currentTab = 'profile';
    let isInteracting = false;
    const DAY_IN_MS = 40000; 

    // ì €ì¥ëœ ë‚ ì§œ ë¡œë“œ
    let gameDate = JSON.parse(localStorage.getItem('savedGameDate')) || { month: 3, day: 1 };
    
    // [ì¶”ê°€] ë¡œê·¸ ì €ì¥ì†Œ ë¡œë“œ
    let gameLogs = JSON.parse(localStorage.getItem('hapsa_game_logs')) || [];

    let lastTimeCheck = Date.now();
    let lastDialogTime = parseInt(localStorage.getItem('savedLastDialogTime')) || 0;

    function getSeason(month) {
        if (month >= 3 && month <= 5) return 'spring';
        if (month >= 6 && month <= 8) return 'summer';
        if (month >= 9 && month <= 11) return 'autumn';
        return 'winter'; 
    }

    function updateTime() {
        const now = Date.now();
        if (now - lastTimeCheck >= DAY_IN_MS) {
            lastTimeCheck = now;
            advanceDay();
        }
        updateDateUI();
        requestAnimationFrame(updateTime);
    }

    function advanceDay() {
        gameDate.day++;
        if (gameDate.day > 30) {
            gameDate.day = 1;
            gameDate.month++;
            if (gameDate.month > 12) gameDate.month = 1;
        }

        const isEventDay = (gameDate.day === 10 || gameDate.day === 20 || gameDate.day === 30);
        addLog(`${gameDate.month}ì›” ${gameDate.day}ì¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤`, true);

        if (isEventDay) {
            setTimeout(triggerSpecialEvent, 1000);
        }

        localStorage.setItem('savedGameDate', JSON.stringify(gameDate));
        updateDateUI();
    }

    function triggerSpecialEvent() {
        const season = getSeason(gameDate.month);
        const data = specialEventDB[season];
        if (!data) return;

        const popup = document.getElementById('event-popup');
        if (popup) {
            document.getElementById('popup-title').innerText = data.title;
            document.getElementById('popup-desc').innerText = "ìŠ¤í˜ì…œ ì—í”¼ì†Œë“œ!";
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
        }

        addLog(`<span style="color:#d35400;">[${data.title}]</span> ${data.log}`, false);
        showBubble('dangbo', data.talk.dangbo, 'high');
        setTimeout(() => showBubble('chung', data.talk.chung, 'low'), 1500);
    }

    function updateDateUI() {
        const seasonKey = getSeason(gameDate.month);
        const season = seasonInfo[seasonKey];
        const header = document.getElementById('log-header-text');
        if (header) header.innerText = `${season.icon} ${season.name} | ${gameDate.month}ì›” ${gameDate.day}ì¼ì˜ ê¸°ë¡`;

        const bg = document.getElementById('game-bg');
        if (bg) bg.style.backgroundImage = `url('bg/${seasonKey}.jpg')`;
    }

    // ================= 4. UI ë° ë Œë”ë§ =================
    function toggleInfoPanel() {
        const panel = document.getElementById('info-panel');
        const btn = document.getElementById('mobile-toggle-btn');
        panel.classList.toggle('open');
        btn.innerText = panel.classList.contains('open') ? 'â–²' : 'â–¼';
    }

    function selectCharacter(id) {
        currentUserId = id;
        document.querySelectorAll('.char-select-btn').forEach(b => b.classList.remove('active'));
        const btn = document.getElementById(id === 'dangbo' ? 'btn-dangbo' : 'btn-chung');
        if (btn) btn.classList.add('active');
        renderInfoContent();
    }

    function switchTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.sub-tab-btn').forEach(b => {
            b.classList.remove('active');
            const tabMap = { 'profile': 'í”„ë¡œí•„', 'inventory': 'ì†Œì§€í’ˆ', 'relation': 'ê´€ê³„' };
            if (b.innerText === tabMap[tabName]) b.classList.add('active');
        });
        renderInfoContent();
    }

    function renderInfoContent() {
        const data = charData[currentUserId];
        const display = document.getElementById('info-display-area');
        if (!display) return;
        
        let html = '';

        if (currentTab === 'profile') {
            const traitOptions = personalityList.map(p =>
                `<option value="${p}" ${data.trait === p ? 'selected' : ''}>${p}</option>`
            ).join('');
            const nameTagColor = getContrastYIQ(data.color);

            html = `
            <div style="text-align:center; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #eee;">
                <h2 id="char-name-display" class="char-signature-font" style="color:${data.color}; margin-bottom:5px;">${data.name}</h2>
                <span id="char-title-display" class="char-signature-font" style="background:${data.color}; color:${nameTagColor}; padding:3px 8px; border-radius:10px; font-size:0.8rem;">${data.title}</span>
            </div>
            
            <div style="display:flex; gap:10px; width:100%;">
                <div class="info-box" style="flex:1; margin-bottom:10px;">
                    <span class="info-label">ğŸ“ ìœ„ì¹˜ (ê³µ/ìˆ˜)</span>
                    <select class="custom-select" onchange="updateCharSetting('position', this.value)">
                        <option value="left" ${data.position === 'left' ? 'selected' : ''}>ì™¼ìª½ (ê³µ)</option>
                        <option value="right" ${data.position === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½ (ìˆ˜)</option>
                    </select>
                </div>
                <div class="info-box" style="flex:1; margin-bottom:10px;">
                    <span class="info-label">âš§ ì„±ë³„</span>
                    <select class="custom-select" onchange="updateCharSetting('gender', this.value)">
                        <option value="ë‚¨ì„±" ${data.gender === 'ë‚¨ì„±' ? 'selected' : ''}>ë‚¨ì„± â™‚ï¸</option>
                        <option value="ì—¬ì„±" ${data.gender === 'ì—¬ì„±' ? 'selected' : ''}>ì—¬ì„± â™€ï¸</option>
                    </select>
                </div>
            </div>

            <div class="info-box">
                <span class="info-label">ğŸ§  ì„±ê²© ì„¤ì •</span>
                <select class="custom-select" onchange="updateCharSetting('trait', this.value)">
                    ${traitOptions}
                </select>
            </div>

            <div class="info-box">
                <span class="info-label">ğŸ¨ ëŒ€í‘œ ì»¬ëŸ¬ ì„¤ì •</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <input type="color" value="${data.color}" onchange="updateCharSetting('color', this.value)" style="width:50px; height:30px; padding:0; border:none; background:none; cursor:pointer;">
                    <span style="font-size:0.8rem; color:#666;">í´ë¦­í•˜ì—¬ ë³€ê²½</span>
                </div>
            </div>
            <button class="save-btn" onclick="saveCharacterSettings()">ğŸ’¾ ì„¤ì • ì €ì¥í•˜ê¸°</button>
            `;
        } else if (currentTab === 'inventory') {
            html = `<div style="padding:5px;">
                        <div style="margin-bottom:10px; font-weight:bold; color:#555;">ì†Œì§€í•˜ê³  ìˆëŠ” ë¬¼í’ˆ</div>
                        ${data.inventory.map(i => `<span class="item-badge">${i}</span>`).join('')}
                    </div>`;
        } else if (currentTab === 'relation') {
            html = `<div style="padding:5px;">`;
            html += `
                <div class="info-box" style="margin-bottom:15px; background:#f9f9f9;">
                    <div style="font-weight:bold; margin-bottom:5px; color:#333;">ğŸ“Š í˜„ì¬ ê´€ê³„ë„</div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>ğŸ¤ ì¹œë°€ë„: <b>${data.intimacy}</b></span>
                        <span class="badge-title" style="background:#ddd; padding:2px 6px; border-radius:4px; font-size:0.8rem;">${data.relationshipTitle}</span>
                    </div>
                    ${data.affection > 0 || data.maxAffectionLevelIdx > 0 ? `
                    <div style="display:flex; justify-content:space-between; color:#e91e63;">
                        <span>ğŸ’• í˜¸ê°ë„: <b>${data.affection}</b></span>
                        <span class="badge-love" style="background:#fce4ec; padding:2px 6px; border-radius:4px; font-size:0.8rem;">${data.loveTitle}</span>
                    </div>` : ''}
                </div>
            `;
            html += data.relations.map(r => `
                <div class="rel-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <strong style="font-size:1rem;">To. ${r.target}</strong>
                        <span style="font-size:0.8rem; background:#eee; padding:2px 6px; border-radius:4px;">${r.rel}</span>
                    </div>
                    <div style="font-size:0.9rem; color:#666;">${fillTitle(r.desc, data.title)}</div>
                </div>`).join('');
            html += `</div>`;
        }
        display.innerHTML = html;
    }

    function saveCharacterSettings(isSilent = false) {
        localStorage.setItem('hapsa_char_settings', JSON.stringify(charData));
        if (!isSilent) {
            alert("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    }

    function loadCharacterSettings() {
        const saved = localStorage.getItem('hapsa_char_settings');
        if (saved) {
            const parsed = JSON.parse(saved);
            Object.keys(parsed).forEach(key => {
                if (charData[key]) {
                    charData[key].gender = parsed[key].gender;
                    charData[key].trait = parsed[key].trait;
                    if (parsed[key].color) charData[key].color = parsed[key].color;
                    if (parsed[key].position) charData[key].position = parsed[key].position;
                    // ì €ì¥ëœ ì ìˆ˜ ë° ì¹­í˜¸ ë¶ˆëŸ¬ì˜¤ê¸°
                    if (parsed[key].intimacy !== undefined) charData[key].intimacy = parsed[key].intimacy;
                    if (parsed[key].affection !== undefined) charData[key].affection = parsed[key].affection;
                    if (parsed[key].maxIntimacyLevelIdx !== undefined) charData[key].maxIntimacyLevelIdx = parsed[key].maxIntimacyLevelIdx;
                    if (parsed[key].maxAffectionLevelIdx !== undefined) charData[key].maxAffectionLevelIdx = parsed[key].maxAffectionLevelIdx;
                    if (parsed[key].relationshipTitle) charData[key].relationshipTitle = parsed[key].relationshipTitle;
                    if (parsed[key].loveTitle) charData[key].loveTitle = parsed[key].loveTitle;
                }
            });
        }
    }

    function updateCharSetting(key, value) {
        if (charData[currentUserId]) {
            charData[currentUserId][key] = value;
            if (key === 'color') {
                const nameEl = document.getElementById('char-name-display');
                if (nameEl) nameEl.style.color = value;
                const titleEl = document.getElementById('char-title-display');
                if (titleEl) {
                    titleEl.style.backgroundColor = value;
                    titleEl.style.color = getContrastYIQ(value);
                }
            }
        }
    }

    // [ìˆ˜ì •] ë¡œê·¸ ì €ì¥ ê¸°ëŠ¥ ì¶”ê°€: customTimeì´ ìˆìœ¼ë©´ ì €ì¥ëœ ì‹œê°„ ì‚¬ìš©
    function addLog(msg, isSpecial = false, customTime = null) {
        const box = document.getElementById('log-box');
        if (!box) return;

        // 1. ì‹œê°„ ê²°ì • (ìƒˆ ë¡œê·¸ë©´ í˜„ì¬ ì‹œê°„, ë³µêµ¬ëœ ë¡œê·¸ë©´ ì €ì¥ëœ ì‹œê°„)
        const timeStr = customTime || new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        const d = document.createElement('div');
        if (isSpecial) {
            d.className = 'log-entry log-date';
            d.innerHTML = `<div style="font-weight:bold; font-style:italic; opacity:0.8;">â”€ ${msg} â”€</div>`;
        } else {
            d.className = 'log-entry';
            
            // Love ì´ë²¤íŠ¸ ë¡œê·¸ ìŠ¤íƒ€ì¼ ì ìš© (í•‘í¬ìƒ‰)
            if (msg.includes('[Love ì´ë²¤íŠ¸ ë°œë™!]')) {
                d.style.backgroundColor = "#fff0f5"; // ì—°í•œ í•‘í¬ ë°°ê²½
                d.style.borderLeft = "4px solid #e91e63"; // ì§„í•œ í•‘í¬ í…Œë‘ë¦¬
                d.style.color = "#d81b60"; // ê°€ë…ì„± ì¢‹ì€ í•‘í¬ í…ìŠ¤íŠ¸
            } else if (msg.includes('[ëŒ€í™”]')) {
                d.classList.add('log-social');
            } else {
                d.classList.add('log-system');
            }

            const formattedMsg = msg.replace(/\[(.*?)\]/g, '<span style="font-weight:bold;">[$1]</span>');
            d.innerHTML = `<span class="log-time">${timeStr}</span>${formattedMsg}`;
        }
        
        // ì¤‘ìš”: ë¡œê·¸ë¥¼ í™”ë©´ì— ì¶”ê°€
        box.prepend(d);
        if (box.children.length > 50) box.lastChild.remove();

        // 2. ìƒˆ ë¡œê·¸ë¼ë©´(customTimeì´ ì—†ë‹¤ë©´) ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        if (!customTime) {
            gameLogs.push({ msg: msg, isSpecial: isSpecial, time: timeStr });
            // ì €ì¥ ê°¯ìˆ˜ ì œí•œ (ìµœê·¼ 50ê°œë§Œ ì €ì¥)
            if (gameLogs.length > 50) gameLogs.shift();
            localStorage.setItem('hapsa_game_logs', JSON.stringify(gameLogs));
        }
    }

    // [ì¶”ê°€] ì €ì¥ëœ ë¡œê·¸ ë³µêµ¬ í•¨ìˆ˜
    function restoreLogs() {
        // ì˜¤ë˜ëœ ìˆœì„œëŒ€ë¡œ ë˜ì–´ ìˆëŠ” ë°°ì—´ì„ ì—­ìˆœìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³ ,
        // addLogê°€ prepend(ë§¨ ìœ„ë¡œ ì¶”ê°€)í•˜ë¯€ë¡œ, ê³¼ê±° ë¡œê·¸ë¶€í„° ìˆœì„œëŒ€ë¡œ ë„£ì–´ì•¼ í™”ë©´ì—ì„œ ì•„ë˜ë¡œ ë°€ë¦¼
        // í•˜ì§€ë§Œ ì±„íŒ…ì€ ìµœì‹ ì´ ë§¨ ìœ„ì´ë¯€ë¡œ, ì˜¤ë˜ëœ ê²ƒë¶€í„° addLogë¥¼ í˜¸ì¶œí•˜ë©´
        // [Old1] -> [Old2, Old1] ... ìˆœìœ¼ë¡œ ìŒ“ì„.
        // ì±„íŒ…ì°½ì´ 'ìœ„ë¡œ ìŒ“ì´ëŠ”' êµ¬ì¡°(prepend)ë¼ë©´, ë°°ì—´ì˜ 0ë²ˆ(ê°€ì¥ ì˜¤ë˜ëœ ê²ƒ)ë¶€í„° ë„£ëŠ”ê²Œ ë§ìŒ.
        gameLogs.forEach(log => {
            addLog(log.msg, log.isSpecial, log.time);
        });
    }

    // ================= 5. ì´ë™ ë° ìƒí˜¸ì‘ìš© =================
    function initCharacters() {
        const stage = document.getElementById('game-stage');
        if (!stage) return;

        for (const [id, data] of Object.entries(charData)) {
            const el = document.createElement('div');
            el.className = 'character-sprite';
            el.id = `char-${id}`;
            el.style.left = data.x + '%';
            el.style.top = data.y + '%';
            el.innerHTML = `
                    <div class="bubble" id="bubble-${id}">...</div>
                    <img src="${data.img}" onerror="this.src='https://via.placeholder.com/100?text=${data.name}'">
                    <div style="background:rgba(0,0,0,0.6); color:white; font-size:11px; padding:2px 6px; border-radius:10px; margin-top:5px; font-weight:bold;">${data.name}</div>
                `;
            el.onclick = () => {
                selectCharacter(id);
                if (window.innerWidth <= 768) toggleInfoPanel();
            };
            stage.appendChild(el);
            scheduleNextMove(id);
        }
    }

    function moveTo(id, targetX, targetY, callback) {
        const el = document.getElementById(`char-${id}`);
        const data = charData[id];
        if (!el) return;

        const dist = Math.sqrt(Math.pow(targetX - data.x, 2) + Math.pow(targetY - data.y, 2));
        const speedFactor = 0.05;
        const duration = Math.max(1.5, dist * speedFactor);

        el.style.transition = `top ${duration}s linear, left ${duration}s linear`;
        el.classList.add('walking');
        el.style.left = targetX + '%';
        el.style.top = targetY + '%';

        data.x = targetX;
        data.y = targetY;

        setTimeout(() => {
            el.classList.remove('walking');
            if (callback) callback();
        }, duration * 1000);
    }

    function scheduleNextMove(id) {
        if (isInteracting) return; 

        const waitTime = Math.random() * 2000 + 1000;

        setTimeout(() => {
            if (isInteracting) {
                scheduleNextMove(id); 
                return;
            }

            const rand = Math.random();
            const isCooltime = (Date.now() - lastDialogTime) < 3000;

            if (id === 'dangbo' && rand < 0.4 && !isCooltime) {
                triggerInteraction();
            } else if (rand < 0.7) {
                triggerMonologue(id);
                const tx = Math.random() * 80 + 10;
                const ty = Math.random() * 60 + 20;
                moveTo(id, tx, ty, () => scheduleNextMove(id));
            } else {
                const tx = Math.random() * 80 + 10;
                const ty = Math.random() * 60 + 20;
                moveTo(id, tx, ty, () => scheduleNextMove(id));
            }
        }, waitTime);
    }

    function triggerInteraction() {
        if (isInteracting) return;
        isInteracting = true;

        const c1 = charData['dangbo'];
        const c2 = charData['chung'];

        let meetX = (c1.x + c2.x) / 2;
        const meetY = (c1.y + c2.y) / 2;
        meetX = Math.max(20, Math.min(80, meetX));

        let arrivedCount = 0;
        const onArrive = () => {
            arrivedCount++;
            if (arrivedCount === 2) startDialog();
        };

        const gap = window.innerWidth <= 768 ? 16 : 8;
        const isDangboLeft = c1.position === 'left'; 

        const dangboTargetX = isDangboLeft ? (meetX - gap) : (meetX + gap);
        const chungTargetX = isDangboLeft ? (meetX + gap) : (meetX - gap);

        moveTo('dangbo', dangboTargetX, meetY, onArrive);
        moveTo('chung', chungTargetX, meetY, onArrive);
    }

    // ================= 6. ëŒ€í™” ë° ì ìˆ˜ ë¡œì§ =================
    function startDialog() {
        const isDangboStarts = Math.random() < 0.5;
        const starterId = isDangboStarts ? 'dangbo' : 'chung';
        const listenerId = isDangboStarts ? 'chung' : 'dangbo';

        const starterData = charData[starterId];
        const listenerData = charData[listenerId];

        let title = "í˜•ë‹˜";
        if (charData['dangbo'].gender === 'ì—¬ì„±' && charData['chung'].gender === 'ì—¬ì„±') title = "ì–¸ë‹ˆ";
        else if (charData['dangbo'].gender === 'ë‚¨ì„±' && charData['chung'].gender === 'ì—¬ì„±') title = "ëˆ„ë‹˜";
        else if (starterId === 'dangbo') title = "ë„ì‚¬ í˜•ë‹˜";

        // Love ì´ë²¤íŠ¸ ì²´í¬
        let isLoveMode = false;
        if (starterData.affection >= 10 && Math.random() < 0.4) {
            isLoveMode = true;
        }

        let dbSection;
        let starterPers = starterData.trait;
        let listenerPers = listenerData.trait;

        if (isLoveMode && dialogDB.love_interaction && dialogDB.love_interaction[starterId]) {
            const loveDB = dialogDB.love_interaction[starterId];
            if (loveDB[starterPers]) {
                dbSection = loveDB[starterPers];
            } else {
                const defaultTrait = (starterId === 'dangbo') ? "ëŠ¥ê¸€ë§ìŒ" : "ë¬´ë˜í•¨";
                dbSection = loveDB[defaultTrait] || loveDB[Object.keys(loveDB)[0]];
            }
        } else {
            isLoveMode = false;
            if (starterId === 'dangbo') {
                dbSection = dialogDB.dangbo_start[starterPers] || dialogDB.dangbo_start["ëŠ¥ê¸€ë§ìŒ"];
            } else {
                dbSection = dialogDB.chung_start[starterPers] || dialogDB.chung_start["ë¬´ë˜í•¨"];
            }
        }

        const scenario = dbSection[Math.floor(Math.random() * dbSection.length)];
        const response = scenario.reaction[listenerPers] || scenario.reaction["ë¬´ë˜í•¨"];

        showBubble(starterId, fillTitle(scenario.t1, title), starterId === 'dangbo' ? 'high' : 'low');

        setTimeout(() => {
            showBubble(listenerId, fillTitle(response.t2, title), listenerId === 'dangbo' ? 'high' : 'low');

            if (isLoveMode) {
                addLog(`[Love ì´ë²¤íŠ¸ ë°œë™!] ğŸ’• ${fillTitle(response.log, title)}`);
            } else {
                addLog(`[ëŒ€í™”] ${fillTitle(response.log, title)}`);
            }

            calculateInteractionScore('dangbo', isLoveMode);
            calculateInteractionScore('chung', isLoveMode);

            setTimeout(() => {
                isInteracting = false;
                lastDialogTime = Date.now();
                localStorage.setItem('savedLastDialogTime', lastDialogTime);
                scheduleNextMove('dangbo');
                scheduleNextMove('chung');
            }, 2500);
        }, 2000);
    }

    function calculateInteractionScore(charId, isLoveInteraction = false) {
        const char = charData[charId];
        
        // [ìˆ˜ì •] ê¸°ë³¸ ì ìˆ˜ í•˜í–¥ (10 -> 3)
        // ì´ì œ ì ìˆ˜ê°€ ì°”ë”ì°”ë” ì˜¤ë¥´ê¸° ë•Œë¬¸ì— ê´€ê³„ ë°œì „ì´ ë” ì†Œì¤‘í•˜ê²Œ ëŠê»´ì§ˆ ê²ë‹ˆë‹¤.
        let baseScore = 3;

        // ì„±ê²© ë³´ì • (ì ìˆ˜ê°€ ì‘ì•„ì ¸ì„œ ì†Œìˆ˜ì ì´ ë‚˜ì˜¤ë¯€ë¡œ ë°˜ì˜¬ë¦¼ ì²˜ë¦¬ ê°•í™”)
        if (char.trait === 'ëŠ¥ê¸€ë§ìŒ') baseScore = Math.ceil(baseScore * 1.5); // 3 * 1.5 = 4.5 -> 5ì 
        else if (char.trait === 'ì§ˆíˆ¬ë§ìŒ') baseScore = Math.floor(baseScore * 0.8); // 3 * 0.8 = 2.4 -> 2ì 

        char.intimacy += baseScore;

        const currentSeason = getSeason(gameDate.month);
        if (currentSeason === 'spring') {
            if (char.affection < 10 || isLoveInteraction) {
                // í˜¸ê°ë„ëŠ” ì¹œë°€ë„ì˜ ì ˆë°˜ (ìµœì†Œ 1ì ì€ ì˜¤ë¥´ê²Œ ì„¤ì •)
                const loveScore = Math.max(1, Math.floor(baseScore / 2));
                char.affection += loveScore;
                if (char.affection > 500) char.affection = 500;
            }
        }

        checkMilestones(charId);
        saveCharacterSettings(true);
        if (currentUserId === charId && currentTab === 'relation') {
            renderInfoContent();
        }
    }

    function checkMilestones(charId) {
        const char = charData[charId];

        // ì¹œë°€ë„
        let currentIntLevelIdx = 0;
        REL_LEVELS.intimacy.forEach((level, idx) => {
            if (char.intimacy >= level.score) currentIntLevelIdx = idx;
        });

        if (currentIntLevelIdx > char.maxIntimacyLevelIdx) {
            char.maxIntimacyLevelIdx = currentIntLevelIdx;
            const newTitle = REL_LEVELS.intimacy[currentIntLevelIdx].title;
            char.relationshipTitle = newTitle;
            triggerMilestoneEvent(charId, 'intimacy', REL_LEVELS.intimacy[currentIntLevelIdx].score, newTitle);
        }

        // í˜¸ê°ë„
        let currentAffLevelIdx = 0;
        REL_LEVELS.affection.forEach((level, idx) => {
            if (char.affection >= level.score) currentAffLevelIdx = idx;
        });

        if (currentAffLevelIdx > char.maxAffectionLevelIdx) {
            char.maxAffectionLevelIdx = currentAffLevelIdx;
            const newTitle = REL_LEVELS.affection[currentAffLevelIdx].title;
            char.loveTitle = newTitle;
            triggerMilestoneEvent(charId, 'affection', REL_LEVELS.affection[currentAffLevelIdx].score, newTitle);
        }
    }

    function triggerMilestoneEvent(charId, type, score, title) {
        const char = charData[charId];
        const typeName = type === 'intimacy' ? 'ì¹œë°€ë„' : 'í˜¸ê°ë„';
        addLog(`[ê²½ì¶•] ğŸŒ¸ ${char.name}ë‹˜ê³¼ <${title}> ë‹¨ê³„ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! (${typeName} ${score}) ğŸŒ¸`, true);

        if (charId === 'dangbo' && type === 'intimacy' && score === 1000) {
            setTimeout(() => {
                showBubble('dangbo', "í˜•ë‹˜, ì´ì œ ìš°ë¦° ì£½ì–´ë„ ê°™ì´ ì£½ëŠ” ê²ë‹ˆë‹¤.", 'high');
                setTimeout(() => showBubble('chung', "ë§ì´ë¼ë„ ëª»í•˜ë©´... ìˆ ì´ë‚˜ ë”°ë¼ë´.", 'low'), 1500);
            }, 500);
        }
    }

    function triggerMonologue(id) {
        if (!dialogDB.solo || !dialogDB.solo[id]) return;

        const lines = dialogDB.solo[id];
        let text = lines[Math.floor(Math.random() * lines.length)];

        const dangbo = charData['dangbo'];
        const chung = charData['chung'];

        let title = "í˜•ë‹˜";
        if (dangbo.gender === 'ì—¬ì„±' && chung.gender === 'ì—¬ì„±') title = "ì–¸ë‹ˆ";
        else if (dangbo.gender === 'ë‚¨ì„±' && chung.gender === 'ì—¬ì„±') title = "ëˆ„ë‹˜";
        else if (id === 'dangbo') title = "ë„ì‚¬ í˜•ë‹˜";

        text = fillTitle(text, title);
        showBubble(id, text);
    }

    // ================= 7. ìœ í‹¸ë¦¬í‹° ë° ì„¤ì • í•¨ìˆ˜ =================
    const themeToggleBtn = document.getElementById('theme-toggle');
    if (themeToggleBtn) {
        const bodyElement = document.body;
        function applyTheme(theme) {
            if (theme === 'dark') bodyElement.classList.add('dark-theme');
            else bodyElement.classList.remove('dark-theme');
            themeToggleBtn.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        themeToggleBtn.addEventListener('click', () => {
            bodyElement.classList.toggle('dark-theme');
            applyTheme(bodyElement.classList.contains('dark-theme') ? 'dark' : 'light');
        });
    }

    function fillTitle(text, title) {
        if(!text) return "";
        let result = text.replace(/{í˜¸ì¹­}/g, title);
        const regex = new RegExp(`(${title})(ì€|ëŠ”|ì´|ê°€|ì„|ë¥¼|ê³¼|ì™€)`, 'g');
        return result.replace(regex, (match, word, josa) => {
            const lastChar = word.charCodeAt(word.length - 1);
            if (lastChar < 0xAC00 || lastChar > 0xD7A3) return match;
            const hasBatchim = (lastChar - 0xAC00) % 28 > 0;
            if (josa === 'ì€' || josa === 'ëŠ”') return word + (hasBatchim ? 'ì€' : 'ëŠ”');
            if (josa === 'ì´' || josa === 'ê°€') return word + (hasBatchim ? 'ì´' : 'ê°€');
            if (josa === 'ì„' || josa === 'ë¥¼') return word + (hasBatchim ? 'ì„' : 'ë¥¼');
            if (josa === 'ê³¼' || josa === 'ì™€') return word + (hasBatchim ? 'ê³¼' : 'ì™€');
            return match;
        });
    }

    function getContrastYIQ(hexcolor) {
        if (!hexcolor) return 'black';
        const r = parseInt(hexcolor.substr(1, 2), 16);
        const g = parseInt(hexcolor.substr(3, 2), 16);
        const b = parseInt(hexcolor.substr(5, 2), 16);
        return (((r * 299) + (g * 587) + (b * 114)) / 1000) >= 128 ? 'black' : 'white';
    }

    // [ìˆ˜ì •] ë§í’ì„  í‘œì‹œ (í˜¼ì£ë§ì€ ì¤‘ì•™, ëŒ€í™”ëŠ” ì¢Œìš° ë¶„ì‚°)
    function showBubble(charId, text, styleType = 'normal') {
        const d = charData[charId];
        const charEl = document.getElementById(`char-${charId}`);
        if (!charEl) return;

        const oldBubble = document.getElementById(`bubble-${charId}`);
        if (oldBubble) oldBubble.remove();

        const bubble = document.createElement('div');
        bubble.id = `bubble-${charId}`;
        bubble.className = 'char-bubble'; // ê¸°ë³¸ í´ë˜ìŠ¤ (CSSì—ì„œ ì¤‘ì•™ ì •ë ¬ë¨)

        // 1. [í•µì‹¬ ìˆ˜ì •] ëŒ€í™”(high/low) ëª¨ë“œì¼ ë•Œë§Œ ì¢Œìš°ë¡œ ë¹„ì¼œì„œê²Œ í•¨
        // normal(í˜¼ì£ë§)ì¼ ë•ŒëŠ” í´ë˜ìŠ¤ë¥¼ ì•ˆ ë¶™ì—¬ì„œ ì •ì¤‘ì•™(translateX(-50%))ì„ ìœ ì§€í•©ë‹ˆë‹¤.
        if (styleType !== 'normal') {
            // í™”ë©´ ì¤‘ì•™(50)ë³´ë‹¤ ì™¼ìª½ì— ìˆìœ¼ë©´ 'is-left', ì˜¤ë¥¸ìª½ì— ìˆìœ¼ë©´ 'is-right'
            if (d.x > 50) {
                bubble.classList.add('is-right'); // ì˜¤ë¥¸ìª½ ë¨¸ë¦¬ ìœ„
            } else {
                bubble.classList.add('is-left');  // ì™¼ìª½ ë¨¸ë¦¬ ìœ„
            }
        }

        // 2. í™”ë©´ êµ¬ì„ì— ë„ˆë¬´ ë°•í˜€ìˆì„ ê²½ìš° (ì´ê±´ í˜¼ì£ë§ì´ë“  ëŒ€í™”ë“  í•­ìƒ ì ìš©)
        if (d.x < 10) bubble.classList.add('edge-left');
        if (d.x > 90) bubble.classList.add('edge-right');

        // 3. ìƒ‰ìƒ ë³€ìˆ˜ ì „ë‹¬
        const bgColor = d.color || "#ffffff";
        bubble.style.setProperty('--bubble-bg', bgColor);
        bubble.style.setProperty('--bubble-text', getContrastYIQ(bgColor));

        bubble.innerText = text;
        
        charEl.appendChild(bubble);

        requestAnimationFrame(() => bubble.classList.add('show'));
        setTimeout(() => {
            bubble.classList.remove('show');
            setTimeout(() => bubble.remove(), 300);
        }, 3500);
    }

    // ================= 8. ê´€ë¦¬ì/ë””ë²„ê·¸ ê¸°ëŠ¥ =================
    function toggleDebugMenu() {
        const modal = document.getElementById('debug-modal');
        modal.classList.toggle('open');
        if (modal.classList.contains('open')) {
            document.getElementById('debug-month').value = gameDate.month;
            document.getElementById('debug-day').value = gameDate.day;
        }
    }

    function warpDate() {
        const m = parseInt(document.getElementById('debug-month').value);
        const d = parseInt(document.getElementById('debug-day').value);

        if (isNaN(m) || isNaN(d) || m < 1 || m > 12 || d < 1 || d > 30) {
            alert("ë‚ ì§œë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”! (1~12ì›”, 1~30ì¼)");
            return;
        }
        gameDate.month = m;
        gameDate.day = d;
        localStorage.setItem('savedGameDate', JSON.stringify(gameDate));
        updateDateUI();
        addLog(`[ì‹œìŠ¤í…œ] âš™ï¸ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹œê°„ì„ ${m}ì›” ${d}ì¼ë¡œ ëŒë ¸ìŠµë‹ˆë‹¤.`, true);
        toggleDebugMenu();
    }

    function resetGameData() {
        if (!confirm("ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì¹œë°€ë„/í˜¸ê°ë„ì™€ ë‚ ì§œ, ê·¸ë¦¬ê³  ë¡œê·¸ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\n(ì„±ê²©, ì„±ë³„ ì„¤ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤)")) {
            return;
        }
        gameDate = { month: 3, day: 1 };
        localStorage.setItem('savedGameDate', JSON.stringify(gameDate));
        
        // [ì¶”ê°€] ë¡œê·¸ ë°ì´í„° ì´ˆê¸°í™”
        gameLogs = [];
        localStorage.removeItem('hapsa_game_logs');
        document.getElementById('log-box').innerHTML = '';

        for (const key in charData) {
            const char = charData[key];
            char.intimacy = 0;
            char.affection = 0;
            char.maxIntimacyLevelIdx = 0;
            char.maxAffectionLevelIdx = 0;
            char.relationshipTitle = "ì•„ëŠ”ì‚¬ì´"; 
            char.loveTitle = "-"; 
        }
        saveCharacterSettings(true);
        updateDateUI();
        if (currentTab === 'relation') renderInfoContent();
        addLog("[ì‹œìŠ¤í…œ] âš ï¸ ëª¨ë“  ê´€ê³„ì™€ ì‹œê°„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", true);
        toggleDebugMenu();
        alert("ì´ˆê¸°í™” ì™„ë£Œ!");
    }

    // ================= 9. ì‹¤í–‰ ë° ì™¸ë¶€ ë…¸ì¶œ =================
    loadCharacterSettings();
    renderInfoContent();
    initCharacters();
    updateDateUI();
    updateTime();
    
    // [ì¶”ê°€] ì €ì¥ëœ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤í–‰
    restoreLogs();

    window.selectCharacter = selectCharacter;
    window.switchTab = switchTab;
    window.toggleInfoPanel = toggleInfoPanel;
    window.saveCharacterSettings = saveCharacterSettings;
    window.updateCharSetting = updateCharSetting;
    window.toggleDebugMenu = toggleDebugMenu;
    window.warpDate = warpDate;
    window.resetGameData = resetGameData;
});