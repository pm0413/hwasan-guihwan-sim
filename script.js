document.addEventListener("DOMContentLoaded", function () {

    // ================= ë°ì´í„° =================
    const charData = {
        'dangbo': {
            name: "ë‹¹ë³´",
            title: "ì•”ì¡´(æš—å°Š)",
            gender: "ë‚¨ì„±", // ê¸°ë³¸ê°’: ë‚¨ì„±
            trait: "ëŠ¥ê¸€ë§ìŒ", // ê¸°ë³¸ê°’: ëŠ¥ê¸€ë§ìŒ
            inventory: ["ë¹„ë„ x12", "ë…ë³‘", "ìµœê³ ê¸‰ ìˆ "],
            relations: [{
                target: "ì²­ëª…",
                rel: "ì˜í˜•ì œ",
                desc: "í‰ìƒì„ ë”°ë¥¼ ì£¼êµ°ì´ì {í˜¸ì¹­}."
                }],
            img: "character/ë‹¹ë³´.png",
            color: "#4CAF50",
            x: 30,
            y: 60
        },
        'chung': {
            name: "ì²­ëª…",
            title: "ë§¤í™”ê²€ì¡´(æ¢…èŠ±åŠå°Š)",
            gender: "ë‚¨ì„±", // ê¸°ë³¸ê°’: ë‚¨ì„±
            trait: "ë¬´ë˜í•¨", // ê¸°ë³¸ê°’: ë¬´ë˜í•¨
            inventory: ["ë§¤í™”ê²€", "ë‹¹ê³¼", "êµ°ë§Œë‘"],
            relations: [{
                target: "ë‹¹ë³´",
                rel: "ì˜í˜•ì œ",
                desc: "ê·€ì°®ì§€ë§Œ ë¯¿ìŒì§í•œ ë…€ì„."
                }],
            img: "character/ì²­ëª….png",
            color: "#F44336",
            x: 70,
            y: 60
        }
    };

    // ì„±ê²© ëª©ë¡ (ë‚˜ì¤‘ì— ì—¬ê¸°ì— "ì§‘ì°©í•¨" ë“±ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤)
    const personalityList = ["ëŠ¥ê¸€ë§ìŒ", "ë¬´ë˜í•¨", "ì§ˆíˆ¬ë§ìŒ"];

    const dialogDB = {
        // ğŸŸ¢ ë‹¹ë³´ê°€ ë¨¼ì € ë§ì„ ê±°ëŠ” ìƒí™©
        "dangbo_start": {
            "ëŠ¥ê¸€ë§ìŒ": [{
                    t1: "ì‚¬ì²œë‹¹ê°€ë¡œ ë†€ëŸ¬ ì˜¤ì‹­ì‡¼. {í˜¸ì¹­} ì¢‹ì•„í•˜ì‹œëŠ” ë…ì£¼ê°€ ì•„ì£¼ ë§ìŠµë‹ˆë‹¤.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ë…ì£¼? ë‚´ ê°„ì´ ë²„í…¨ì¤„ê¹Œ ëª¨ë¥´ê² ë„¤.",
                            log: "ì²­ëª…ì´ ë¤ë¤í•˜ê²Œ ìˆ  ê³„ì‚°ì„ í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ê°€ë©´ ë„¤ê°€ ë‹¤ ì˜ëŠ” ê±°ì§€? ë‹¹ê°€ ì°½ê³  í„¸ëŸ¬ ê°„ë‹¤!",
                            log: "ì²­ëª…ì´ ì‹ ì´ ë‚˜ì„œ ë§ì¥êµ¬ì¹©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë‹¹ê°€ì— ë‚˜ ë§ê³  ë˜ ëˆ„êµ¬ ë¶€ë¥¸ ë†ˆ ìˆëƒ?",
                            log: "ì²­ëª…ì´ ê´œíˆ ì‚ë”±í•˜ê²Œ ë¬»ìŠµë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "{í˜¸ì¹­}, ì €ë‘ ë¹„ë¬´ë‚˜ í•œ íŒ ì–´ë– ì‹­ë‹ˆê¹Œ? ì‚´ì‚´ í•´ë“œë¦´ê²Œ.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê·€ì°®ë‹¤. ì ì´ë‚˜ ìë¼.",
                            log: "ì²­ëª…ì´ í•˜í’ˆì„ í•˜ë©° ê±°ì ˆí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì‚´ì‚´? ëŒ€ê°€ë¦¬ ê¹¨ì ¸ë´ì•¼ ì •ì‹  ì°¨ë¦¬ì§€?",
                            log: "ì²­ëª…ì´ ë¹„ë¦¿í•˜ê²Œ ì›ƒìœ¼ë©° ê²€ì„ ì¡ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë‚˜ë‘ ëª¸ ì„ê³  ì‹¶ì–´ì„œ ì•ˆë‹¬ì´ ë‚¬êµ¬ë‚˜?",
                            log: "ì²­ëª…ì´ ë¬˜í•œ í‘œì •ìœ¼ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ìš”ì¦˜ í™”ì‚° ë†ˆë“¤ì€ ì•„ì£¼ ê¸°ìš´ì´ ë„˜ì¹˜ë”êµ°ìš”. {í˜¸ì¹­} ë‹®ì•„ì„œ ê·¸ëŸ°ê°€?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ëƒ¥ ë‚´ë²„ë ¤ ë‘¬ë¼. ì• ë“¤ì´ë‹¤.",
                            log: "ì²­ëª…ì´ ë©€ë¦¬ ìˆ˜ë ¨í•˜ëŠ” ì œìë“¤ì„ ë´…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë‚˜ ë‹®ì•˜ìœ¼ë©´ ë²Œì¨ ì‚¬ê³  ì³ë„ ëª‡ ë²ˆì€ ì³¤ì§€.",
                            log: "ì²­ëª…ì´ ë‚„ë‚„ê±°ë¦¬ë©° ì›ƒìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ê·¸ë†ˆë“¤ ë³´ëŠë¼ ë‚´ê°€ ì–¼ë§ˆë‚˜ ë°”ìœë°. ë„Œ ì ìì½” ìˆì–´.",
                            log: "ì²­ëª…ì´ í”¼ê³¤í•œ ë“¯ ëˆˆì„ ë¹„ë¹•ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì´ ë‹¹ë³´ê°€ {í˜¸ì¹­} ìƒê°í•´ì„œ ì‚° ì†Œì¤‘í•œ ë‹¹ê³¼ì…ë‹ˆë‹¤. ì, ì•„~ í•˜ì‹­ì‡¼.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì£¼ë ¤ë©´ ê·¸ëƒ¥ ì¤˜ë¼. ì§•ê·¸ëŸ½ê²Œ.",
                            log: "ì²­ëª…ì´ ë‹¹ê³¼ë§Œ ì™ ëºì–´ê°‘ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì†ê°€ë½ê¹Œì§€ ì”¹ì–´ë¨¹ì–´ë„ ë˜ëƒ?",
                            log: "ì²­ëª…ì´ ì…ì„ í¬ê²Œ ë²Œë¦¬ë©° ì¥ë‚œì„ ì¹©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë„ˆ ë‹¤ë¥¸ ë†ˆí•œí…Œë„ ì´ë ‡ê²Œ ë¨¹ì—¬ì£¼ëƒ?",
                            log: "ì²­ëª…ì´ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ëˆˆì´ˆë¦¬ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "{í˜¸ì¹­} ì™œ ìê¾¸ ì˜ìƒê²¨ì§€ì‹œëŠ” ê²ë‹ˆê¹Œ? ì´ ì•„ìš° ì‹¬ì¥ì´ ë–¨ë ¤ì„œ ì›.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "í—›ì†Œë¦¬ ë§ê³  ì ì´ë‚˜ ì.",
                            log: "ì²­ëª…ì´ ê·€ì°®ë‹¤ëŠ” ë“¯ ê³ ê°œë¥¼ ëŒë¦½ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë„¤ ì‹¬ì¥ë§Œ ë–¨ë¦¬ê² ëƒ? ì˜¨ ê°•í˜¸ê°€ ë‚œë¦¬ë‹¤.",
                            log: "ì²­ëª…ì´ ìì•„ë„ì·¨ì— ë¹ ì ¸ ëŒ€ê¾¸í•©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ì…ë§Œ ì‚´ì•„ì„œ... ë‚˜ ë§ê³  ë”´ ë†ˆí•œí…Œ ê·¸ ì†Œë¦¬ í•˜ë©´ ì£½ëŠ”ë‹¤.",
                            log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì…ì„ íˆ­ ì¹©ë‹ˆë‹¤."
                        }
                    }
                    }
                ],
            "ì§ˆíˆ¬ë§ìŒ": [{
                    t1: "ì•„ê¹Œ ê·¸ ì¥ë¬¸ì¸ì´ë‘ ë¬´ìŠ¨ ì–˜ê¸°ë¥¼ ê·¸ë ‡ê²Œ ì˜¤ë˜ í•˜ì‹  ê²ë‹ˆê¹Œ?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ëƒ¥ ë¬¸íŒŒ ìš´ì˜ ì–˜ê¸°ì§€. ë³„ê±° ì—†ë‹¤.",
                            log: "ì²­ëª…ì´ ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë‹µí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì™œ, ì§ˆíˆ¬ ë‚˜ëƒ? ì•„ì£¼ ê·€ì—¬ì›Œ ì£½ê² ë„¤.",
                            log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ë¨¸ë¦¬ë¥¼ ì“°ë‹¤ë“¬ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë„ˆë„ ì•„ê¹Œ ë‹¹ê°€ ì• ë“¤ì´ë‘ ì›ƒê³  ë– ë“¤ë”ë§Œ!",
                            log: "ë‘ ì‚¬ëŒ ì‚¬ì´ì— ë¬˜í•œ ê¸°ì‹¸ì›€ì´ íë¦…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì œ ë¹„ë„ê°€ ì¢‹ìŠµë‹ˆê¹Œ, í™”ì‚°ì˜ ê²€ì´ ì¢‹ìŠµë‹ˆê¹Œ? ì†”ì§í•˜ê²Œ ë§ì”€í•´ ë³´ì‹­ì‡¼.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ë‘˜ ë‹¤ ì‚¬ëŒ ì¡ëŠ” ê±´ ë˜‘ê°™ì§€ ë­.",
                            log: "ì²­ëª…ì´ ê²€ë‚ ì„ ë‹¦ìœ¼ë©° ëŒ€ë‹µí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë‹¹ì—°íˆ ë„¤ ì–¼êµ´ì´ ì œì¼ ì¢‹ì§€, ì„ë§ˆ!",
                            log: "ì²­ëª…ì´ ìœ™í¬ë¥¼ ë‚ ë¦½ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ê²€ì€ ë‚´ ëª©ìˆ¨ì´ë‹¤. ë„Œ ë‚´... ì•„ë‹ˆë‹¤, ëë‹¤.",
                            log: "ì²­ëª…ì´ ë§ì„ íë¦¬ë©° ì‘¥ìŠ¤ëŸ¬ì›Œí•©ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "{í˜¸ì¹­}, ì € ë§ê³  ë‹¤ë¥¸ ë†ˆì´ë‘ ìˆ  ë§ˆì‹œê¸°ë§Œ í•´ë³´ì‹­ì‡¼. ì‚¬ì²œì˜ ë…ì„ ë‹¤ í’€ ê²ë‹ˆë‹¤.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ìˆ  ë§ˆì‹œëŠ”ë° ë…ì€ ì™œ í’€ì–´. ë¬´ì„­ê²Œ.",
                            log: "ì²­ëª…ì´ ì”ì„ ì±„ìš°ë©° ë¬´ì‹¬í•˜ê²Œ ë§í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì˜¤~ ë¬´ì„œì›Œë¼. ê·¸ëŸ¼ ë„¤ê°€ ë§¤ì¼ ìˆ  ì‚¬ì¤„ ê±°ì•¼?",
                            log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì–´ê¹¨ì— íŒ”ì„ ì˜¬ë¦½ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "í˜‘ë°•ì´ëƒ? ë‚œ ë„ˆ ì—†ìœ¼ë©´ ìˆ ë§› ì•ˆ ë‚˜ê±°ë“ ?",
                            log: "ì²­ëª…ì´ íˆ´íˆ´ê±°ë¦¬ë©° ë‹¹ë³´ì˜ ì”ì„ ì±„ì›ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "{í˜¸ì¹­} ì™œ ì €í•œí…Œë§Œ ê¹Œì¹ í•˜ê²Œ êµ¬ì‹œëŠ” ê²ë‹ˆê¹Œ? ë”´ ë†ˆë“¤í•œí… ì˜ ì›ƒì–´ì£¼ë©´ì„œ!",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ë‚´ê°€ ì–¸ì œ? ì°©ê°ì´ë‹¤.",
                            log: "ì²­ëª…ì´ ë©í•œ í‘œì •ìœ¼ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ê°€ê¹Œìš°ë‹ˆê¹Œ í¸í•´ì„œ ê·¸ë ‡ì§€. ì´ ë°”ë³´ì•¼.",
                            log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ëº¨ì„ ì‚´ì§ ê¼¬ì§‘ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë„¤ê°€ í•˜ë„ ë¶™ì–´ë‹¤ë‹ˆë‹ˆê¹Œ ìˆ¨ì´ ë§‰í˜€ì„œ ê·¸ë˜!",
                            log: "ì²­ëª…ì´ ê´œíˆ í°ì†Œë¦¬ë¥¼ ì¹©ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì˜¤ëŠ˜ë”°ë¼ ì˜·ì°¨ë¦¼ì´ ë„ˆë¬´ ê¹”ë”í•˜ì‹œêµ°ìš”. ëˆ„êµ¬ ë³´ì—¬ì£¼ë ¤ê³  ê¾¸ë¯¸ì‹  ê²ë‹ˆê¹Œ?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ë¹¨ë˜ê°€ ì´ê²ƒë°–ì— ì—†ì–´ì„œ ì…ì—ˆë‹¤.",
                            log: "ì²­ëª…ì´ ì˜· ë§¤ë¬´ìƒˆë¥¼ ëŒ€ì¶© ì •ë¦¬í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë„ˆ ë³´ì—¬ì£¼ë ¤ê³  ì…ì—ˆì§€. ì–´ë•Œ, ë°˜í–ˆëƒ?",
                            log: "ì²­ëª…ì´ í•œ ë°”í€´ ëŒë©° í¬ì¦ˆë¥¼ ì·¨í•©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ì•„ë¬´ë„ ì•ˆ ë³´ì—¬ì¤„ ê±°ë‹ˆê¹Œ ë„ˆë§Œ ë´ë¼. ëëƒ?",
                            log: "ì²­ëª…ì´ ì–¼êµ´ì´ ë¶‰ì–´ì§„ ì±„ ì˜ì•„ë¶™ì…ë‹ˆë‹¤."
                        }
                    }
                    }
                ],
            "ë¬´ë˜í•¨": [{
                    t1: "{í˜¸ì¹­}, ìˆ˜ë ¨ë„ ì¢‹ì§€ë§Œ ê°€ë”ì€ ì¢€ ì‰¬ë©´ì„œ í•˜ì‹­ì‹œì˜¤.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì˜¤ëƒ. ì•ˆ ê·¸ë˜ë„ ê·¸ëŸ¬ë ¤ë˜ ì°¸ì´ë‹¤.",
                            log: "ë‘ ì‚¬ëŒì´ ë‚˜ë€íˆ ì•‰ì•„ ë•€ì„ ì‹í™ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ê±±ì •í•´ì£¼ëŠ” ê±°ëƒ? ì—­ì‹œ ìš°ë¦¬ ì•„ìš°ë°–ì— ì—†ë„¤!",
                            log: "ì²­ëª…ì´ ë‹¹ë³´ì˜ ì–´ê¹¨ë¥¼ íˆ­ ì¹˜ë©° ì›ƒìŠµë‹ˆë‹¤."
                        },
                        "ê¹Œì¹ í•¨": {
                            t2: "ì”ì†Œë¦¬ ë§ˆë¼. ë„¤ ë¹„ë„ë‚˜ ë” ë‹¦ì•„ë†”.",
                            log: "ì²­ëª…ì´ ì¸¤ì¸¤ê±°ë¦¬ë©° ë‹¤ì‹œ ê²€ì„ íœ˜ë‘ë¦…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "í•´ê°€ ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì´ë§Œ ë“¤ì–´ê°ˆê¹Œìš”?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ë˜, ê°€ì. ë°°ê³ í”„ë„¤.",
                            log: "ë‘ ì‚¬ëŒì´ ë…¸ì„ì„ ë’¤ë¡œí•˜ê³  ìˆ™ì†Œë¡œ í–¥í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë²Œì¨? ë°¤ìƒˆë„ë¡ ë‚˜ë‘ ë†€ì•„ì¤˜ì•¼ì§€!",
                            log: "ì²­ëª…ì´ ì•„ì‰¬ìš´ ë“¯ ë‹¹ë³´ì˜ ì†Œë§¤ë¥¼ ë¶™ì¡ìŠµë‹ˆë‹¤."
                        },
                        "ê¹Œì¹ í•¨": {
                            t2: "ê°€ê³  ì‹¶ìœ¼ë©´ ë„ˆë‚˜ ê°€. ë‚œ ë” í•  ê±°ë‹¤.",
                            log: "ì²­ëª…ì´ ê³ ì§‘ì„ ë¶€ë¦¬ë©° ìë¦¬ë¥¼ ì§€í‚µë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ê¸¸ê°€ì— ê½ƒì´ íˆë”êµ°ìš”. {í˜¸ì¹­} ì¢‹ì•„í•˜ì‹¤ ê²ƒ ê°™ì•„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê½ƒ? ê³ ë§™ë‹¤. ë°©ì— ë‘ë§ˆ.",
                            log: "ì²­ëª…ì´ ë¬´ì‹¬í•˜ê²Œ ê½ƒì„ ë°›ì•„ë“­ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì•„ì´ê³ ~ ìš°ë¦¬ ë‹¹ë³´ê°€ ì›¬ì¼ë¡œ ì´ëŸ° ê½ƒ ì„ ë¬¼ì„?",
                            log: "ì²­ëª…ì´ ê½ƒí–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ì¥ë‚œìŠ¤ëŸ½ê²Œ ì›ƒìŠµë‹ˆë‹¤."
                        },
                        "ê¹Œì¹ í•¨": {
                            t2: "ë‚´ê°€ ë¬´ìŠ¨ ê³„ì§‘ì• ëƒ? ê½ƒì€ ë¬´ìŠ¨...",
                            log: "ì²­ëª…ì´ íˆ¬ëœëŒ€ë©´ì„œë„ ê½ƒì„ ë²„ë¦¬ì§€ ì•Šê³  ì±™ê¹ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì‚¬ì²œì—ì„œ ì„œì‹ ì´ ì™”ìŠµë‹ˆë‹¤. ë‹¹ê°€ ë†ˆë“¤ì´ {í˜¸ì¹­} ì•ˆë¶€ë¥¼ ë¬»ë”êµ°ìš”.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ë‚˜ì•¼ ì˜ ìˆì§€. ê±”ë“¤ë„ ì˜ ì§€ë‚´ë¼ê³  ì „í•´ë¼.",
                            log: "ì²­ëª…ì´ ì„œì‹  ë‚´ìš©ì„ ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë“£ìŠµë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë‚´ ì¸ê¸°ê°€ ì‚¬ì²œê¹Œì§€ ë»—ì¹œ ëª¨ì–‘ì´ë„¤? ã…‹ã…‹",
                            log: "ì²­ëª…ì´ ê¸°ë¶„ ì¢‹ê²Œ ì½§ë…¸ë˜ë¥¼ ë¶€ë¦…ë‹ˆë‹¤."
                        },
                        "ê¹Œì¹ í•¨": {
                            t2: "ê·€ì°®ê²Œ ì‹œë¦¬... ê·¸ë†ˆë“¤ì€ ì™œ ìê¾¸ ë‚´ ì•ˆë¶€ë¥¼ ë¬¼ì–´?",
                            log: "ì²­ëª…ì´ ì¸ìƒì„ ì“°ë©´ì„œë„ ì‹«ì§€ ì•Šì€ ê¸°ìƒ‰ì…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "{í˜¸ì¹­}, ì˜·ì´ ì¢€ ëœ¯ì–´ì¡ŒìŠµë‹ˆë‹¤. ì´ë¦¬ ì£¼ì‹­ì‹œì˜¤. ì œê°€ ê¿°ë§¤ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì•„, ê³ ë§™ë‹¤. ì†ì¬ì£¼ê°€ ì¢‹ë„¤.",
                            log: "ë‹¹ë³´ê°€ ì†œì”¨ ì¢‹ê²Œ ì˜·ì„ ìˆ˜ì„ í•˜ëŠ” ê²ƒì„ ì§€ì¼œë´…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ìš°ë¦¬ ì•„ìš°, ë‚˜ì¤‘ì— ì‹œì§‘ê°€ë„ ë˜ê² ì–´?",
                            log: "ì²­ëª…ì´ ë‚„ë‚„ê±°ë¦¬ë©° ë‹¹ë³´ë¥¼ ë†€ë¦½ë‹ˆë‹¤."
                        },
                        "ê¹Œì¹ í•¨": {
                            t2: "ê·¸ëƒ¥ ë‘¬ë¼. ì´ëŸ° ê±° ì…ëŠ”ë‹¤ê³  ì•ˆ ì£½ëŠ”ë‹¤.",
                            log: "ì²­ëª…ì´ ë¯¼ë§í•œ ë“¯ ì˜·ìë½ì„ ì—¬ë°‰ë‹ˆë‹¤."
                        }
                    }
                    }
                ]
        },

        // ğŸ”´ ì²­ëª…ì´ê°€ ë¨¼ì € ë§ì„ ê±°ëŠ” ìƒí™©
        "chung_start": {
            "ëŠ¥ê¸€ë§ìŒ": [{
                    t1: "ì•¼, ë‹¹ë³´ì•¼. ë„ˆ ì˜¤ëŠ˜ë”°ë¼ ì™œ ì´ë ‡ê²Œ ì˜ìƒê²¨ ë³´ì´ëƒ? ë­ ì˜ëª» ë¨¹ì—ˆì–´?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì›ë˜ ì´ë¬ìŠµë‹ˆë‹¤. ì´ì œì•¼ ì•Œì•„ë³´ì‹  ê²ë‹ˆê¹Œ?",
                            log: "ë‹¹ë³´ê°€ ë¤ë¤í•˜ê²Œ ëŒ€ë‹µí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ëˆˆì— ì œê°€ ë“œë””ì–´ ê½ƒìœ¼ë¡œ ë³´ì´ì‹œëŠ” ëª¨ì–‘ì…ë‹ˆë‹¤?",
                            log: "ë‹¹ë³´ê°€ í•œìˆ  ë” ë– ì„œ ë„ˆìŠ¤ë ˆë¥¼ ë–±ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ê°‘ìê¸° ê·¸ëŸ° ì†Œë¦° ì™œ í•˜ì‹­ë‹ˆê¹Œ? ë”´ ë†ˆí•œí…Œë„ í•˜ì…¨ì£ ?",
                            log: "ë‹¹ë³´ê°€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ëˆˆì´ˆë¦¬ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì‚¬ì²œë‹¹ê°€ì— ëˆ ë§ë‹¤ë©°? ì´ {í˜¸ì¹­} ìš©ëˆ ì¢€ ì£¼ë¼. ì‘?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ëˆ ê´€ë¦¬ì¸ì€ ë”°ë¡œ ìˆìŠµë‹ˆë‹¤. ì œ ë§˜ëŒ€ë¡œ ì•ˆ ë©ë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ë‹¨í˜¸í•˜ê²Œ ê±°ì ˆí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì œ ì§€ê°‘ì€ {í˜¸ì¹­} ê±°ë‚˜ ë‹¤ë¦„ì—†ì£ . ëŒ€ì‹  ì˜¤ëŠ˜ ì €ë‘ ìˆ  í•œì” ì–´ë– ì‹­ë‹ˆê¹Œ?",
                            log: "ë‹¹ë³´ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ìˆ  ì•½ì†ì„ ì¡ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ëˆ í•„ìš”í•  ë•Œë§Œ ì•„ìš° ì°¾ìœ¼ì‹œì§€, ì•„ì£¼.",
                            log: "ë‹¹ë³´ê°€ ì„œìš´í•œ ë“¯ ì…ìˆ ì„ ë‚´ë°‰ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì•¼, ë„¤ê°€ ê·¸ë ‡ê²Œ ë¬´ì‹œë¬´ì‹œí•œ ì•”ì¡´ì´ë¼ë©°? ë‚´ ì•ì—ì„œëŠ” ê·¸ëƒ¥ ê°•ì•„ì§€ ê°™ì€ë°?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "{í˜¸ì¹­} ì•ì—ì„œë§Œ ì´ëŸ¬ëŠ” ê²ë‹ˆë‹¤. ë”´ ë°ì„  ì•ˆ ì´ë˜ìš”.",
                            log: "ë‹¹ë³´ê°€ ì‘¥ìŠ¤ëŸ¬ìš´ ë“¯ ê³ ê°œë¥¼ ëŒë¦½ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì™ˆì™ˆ! ëìŠµë‹ˆê¹Œ? ì´ì œ ì“°ë‹¤ë“¬ì–´ ì£¼ì‹œì£ .",
                            log: "ë‹¹ë³´ê°€ ì¥ë‚œìŠ¤ëŸ½ê²Œ ë¨¸ë¦¬ë¥¼ ë‚´ë°‰ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ê°•ì•„ì§€ ì·¨ê¸‰í•˜ì§€ ë§ˆì‹­ì‡¼. ì €ë„ ë‚¨ìì…ë‹ˆë‹¤!",
                            log: "ë‹¹ë³´ê°€ ê´œíˆ ëª©ì†Œë¦¬ë¥¼ ë†’ì…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë„ˆ ì—†ìœ¼ë‹ˆê¹Œ ì‹¬ì‹¬í•´ ì£½ëŠ” ì¤„ ì•Œì•˜ë‹¤. ì–´ë”” ê°€ì„œ ëˆ„êµ¬ë‘ ë†€ë‹¤ ì˜¨ ê±°ì•¼?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì ì‹œ ë³¼ì¼ ì¢€ ë³´ê³  ì™”ìŠµë‹ˆë‹¤. ë³„ê±° ì•„ë‹™ë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ì°¨ë¶„í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì–´ë¨¸, {í˜¸ì¹­}. ì € ì—†ìœ¼ë©´ ì•ˆ ë˜ëŠ” ëª¸ì´ ë˜ì‹  ê²ë‹ˆê¹Œ?",
                            log: "ë‹¹ë³´ê°€ ê°ë™ë°›ì€ ì²™ í˜¸ë“¤ê°‘ì„ ë–±ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­}ì•¼ë§ë¡œ ì•„ê¹Œ ê·¸ ë„ì‚¬ë†ˆì´ë‘ ì›ƒê³  ê³„ì‹œë˜ë°ìš”?",
                            log: "ë‹¹ë³´ê°€ ì—­ê³µì„ í¼ì¹©ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë‚˜ ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì¢€ ì•ˆ ì¢‹ì€ë°, ë„¤ê°€ ì¬ë¡± ì¢€ ë–¨ì–´ë´ë¼. ê·¸ëŸ¼ í’€ë¦´ ê²ƒ ê°™ì•„.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "...ì œê°€ ë¬´ìŠ¨ ê´‘ëŒ€ì¸ ì¤„ ì•„ì‹­ë‹ˆê¹Œ.",
                            log: "ë‹¹ë³´ê°€ ì–´ì´ì—†ë‹¤ëŠ” ë“¯ ì³ë‹¤ë´…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì¬ë¡±ì€ ë¬´ìŠ¨... ê·¸ëƒ¥ ì œê°€ ì•ˆì•„ ë“œë¦´ê¹Œìš”?",
                            log: "ë‹¹ë³´ê°€ íŒ”ì„ ë²Œë¦¬ë©° ë‹¤ê°€ì˜µë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ì•„ë¬´í•œí…Œë‚˜ ì¬ë¡± í”¼ìš°ë¼ í•˜ê³ ... {í˜¸ì¹­} ì •ë§ ë„ˆë¬´í•˜ì‹­ë‹ˆë‹¤!",
                            log: "ë‹¹ë³´ê°€ ì§„ì§œë¡œ ì‚ì§„ ê¸°ìƒ‰ì„ ë³´ì…ë‹ˆë‹¤."
                        }
                    }
                    }
                ],
            "ë¬´ë˜í•¨": [{
                    t1: "ì•¼ ë‹¹ë³´ì•¼, ë°°ê³ í”„ë‹¤. ë­ ë¨¹ì„ ê±° ì—†ëƒ?",
                    reaction: {
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ë“œì‹œë¼ê³  ë§Œë‘ ì‚¬ì™”ì£ . ì, ì•„~ í•˜ì‹­ì‡¼.",
                            log: "ë‹¹ë³´ê°€ ë§Œë‘ë¥¼ í•˜ë‚˜ ì§‘ì–´ ì…ì— ë„£ì–´ì¤ë‹ˆë‹¤."
                        },
                        "ë¬´ë˜í•¨": {
                            t2: "ë¶€ì—Œì— ê°€ë³´ì‹­ì‡¼. êµ­ìˆ˜ë¼ë„ ì‚¶ì•„ ë“œë¦´ê¹Œìš”?",
                            log: "ë‹¹ë³´ê°€ ì¼ì–´ì„œì„œ ì•ì¹˜ë§ˆë¥¼ ë‘ë¦…ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë§Œë‘ê°€ ì¢‹ìŠµë‹ˆê¹Œ, ì œê°€ ì¢‹ìŠµë‹ˆê¹Œ? ê³¨ë¼ë³´ì‹­ì‡¼.",
                            log: "ë‹¹ë³´ê°€ ë§Œë‘ ì ‘ì‹œë¥¼ ìˆ¨ê¸°ë©° ë¬»ìŠµë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì˜¤ëŠ˜ë”°ë¼ ë¹„ë„ê°€ ì°¸ ë²ˆì©ê±°ë¦¬ë„¤. ê´€ë¦¬ ì¢€ í–ˆëƒ?",
                    reaction: {
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ì‹¬ì¥ ê¿°ëš«ìœ¼ë ¤ê³  ë°¤ìƒˆ ë‹¦ì•˜ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ë¹„ë„ë¥¼ ëŒë¦¬ë©° ì”© ì›ƒìŠµë‹ˆë‹¤."
                        },
                        "ë¬´ë˜í•¨": {
                            t2: "ë¬´ê¸° ê´€ë¦¬ëŠ” ê¸°ë³¸ì´ì£ . {í˜¸ì¹­} ê²€ë„ ë‹¦ì•„ë“œë¦´ê¹Œìš”?",
                            log: "ë‹¹ë³´ê°€ ë§ˆë¥¸ í—ê²Šì„ êº¼ëƒ…ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ì•ˆ ë´ì£¼ì‹œë‹ˆê¹Œ ë¹„ë„ë¼ë„ ë´ë‹¬ë¼ê³  ë‹¦ì•˜ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ì„­ì„­í•œ íˆ¬ë¡œ ë§í•©ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì¡¸ë¦¬ë‹¤... ë‚˜ ì¢€ ì˜ í…Œë‹ˆê¹Œ ê¹¨ìš°ì§€ ë§ˆë¼.",
                    reaction: {
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì œ ë¬´ë¦ ë¹Œë ¤ë“œë¦´ê¹Œìš”? ì•„ì£¼ í¸í•  í…ë°.",
                            log: "ë‹¹ë³´ê°€ ìì‹ ì˜ í—ˆë²…ì§€ë¥¼ í†¡í†¡ ì¹©ë‹ˆë‹¤."
                        },
                        "ë¬´ë˜í•¨": {
                            t2: "ì˜ˆ, í•œìˆ¨ ì£¼ë¬´ì‹­ì‡¼. ê·¼ì²˜ëŠ” ì œê°€ ì§€í‚¤ê² ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ê°€ë§Œíˆ ì˜†ì— ì•‰ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ìëŠ” ë™ì•ˆ ë”´ ë†ˆ ì´ë¦„ ë¶€ë¥´ê¸°ë§Œ í•´ë³´ì‹­ì‡¼.",
                            log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì´ë¶ˆì„ ê¼¼ê¼¼íˆ ë®ì–´ì£¼ë©° ì¤‘ì–¼ê±°ë¦½ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë§¤í™”ê°€ íˆë„¤. ìˆ  ë§ˆì‹œê¸° ì¢‹ì€ ë‚ ì´ë‹¤.",
                    reaction: {
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ê½ƒë³´ë‹¤ {í˜¸ì¹­} ë” ì•„ë¦„ë‹¤ìš°ì‹  ê²Œ ë¬¸ì œì£ .",
                            log: "ë‹¹ë³´ê°€ ê½ƒê°€ë£¨ë¥¼ í„¸ì–´ì£¼ë©° ë§í•©ë‹ˆë‹¤."
                        },
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ëŸ¬ê²Œ ë§ì…ë‹ˆë‹¤. ìˆ ìƒ ë´ì˜¤ê² ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ë¶€ì§€ëŸ°íˆ ì›€ì§ì…ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ê½ƒ ë³´ëŠë¼ ì € ì•ˆ ë³´ì‹œëŠ” ê±° ì•„ë‹ˆì£ ?",
                            log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì‹œì„ ì„ ê°€ë¡œë§‰ìŠµë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë„ˆ ìš”ì¦˜ ì™œ ì´ë ‡ê²Œ ì¡°ìš©í•˜ëƒ? ì–´ë”” ì•„í”ˆ ê±° ì•„ëƒ?",
                    reaction: {
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ê±±ì •í•´ ì£¼ì‹œë‹ˆê¹Œ ê°‘ìê¸° ë‹¤ ë‚˜ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤!",
                            log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì†ì„ ë¥ì„ ì¡ìŠµë‹ˆë‹¤."
                        },
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ëƒ¥ ìƒê°í•  ê²Œ ì¢€ ìˆì–´ì„œ ê·¸ë ‡ìŠµë‹ˆë‹¤. ë©€ì©¡í•©ë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ì‚´ì§ ë¯¸ì†Œ ì§“ìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ë‹¤ë¥¸ ë†ˆë“¤ì´ë‘ë§Œ ë…¸ë‹ˆê¹Œ ê¸°ìš´ì´ ì•ˆ ë‚˜ì£ !",
                            log: "ë‹¹ë³´ê°€ ì…ìˆ ì„ ì‚ì£½ ë‚´ë°‰ë‹ˆë‹¤."
                        }
                    }
                    }
                ],
            "ì§ˆíˆ¬ë§ìŒ": [{
                    t1: "ì•¼, ë‹¹ë³´. ë„ˆ ì•„ê¹Œ ê·¸ ì‚¬ì²œì—ì„œ ì˜¨ ë†ˆì´ë‘ ë­ê°€ ê·¸ë ‡ê²Œ ì¦ê±°ì›Œ ë³´ì´ë”ë¼?",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê°€ë¬¸ ì†Œì‹ì„ ì „í•´ ë“¤ì—ˆì„ ë¿ì…ë‹ˆë‹¤. ë³„ì¼ ì•„ë‹™ë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ í‰ì˜¨í•˜ê²Œ ëŒ€ë‹µí•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì™œìš”? ì œê°€ ë”´ ë†ˆì´ë‘ ë…¸ë‹ˆê¹Œ ë°° ì•„í”„ì‹­ë‹ˆê¹Œ? ã…‹ã…‹",
                            log: "ë‹¹ë³´ê°€ ì²­ëª…ì˜ ì§ˆíˆ¬ë¥¼ ì¦ê¸°ë©° ì›ƒìŠµë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ì €ë„ {í˜¸ì¹­} ë‹¤ë¥¸ ì œìë“¤ì´ë‘ ë¶™ì–´ ìˆëŠ” ê±° ë³´ê¸° ì‹«ê±°ë“ ìš”!",
                            log: "ë‘ ì‚¬ëŒ ì‚¬ì´ì— ë¶ˆê½ƒ íŠ€ëŠ” ì‹ ê²½ì „ì´ ë²Œì–´ì§‘ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë¹„ë„ ê´€ë¦¬ë¥¼ ê·¸ë ‡ê²Œ ì—´ì‹¬íˆ í•  ê±°ë©´ ë‚´ ê²€ë„ ì¢€ ë´ì£¼ì§€ ê·¸ë˜? ì •ì„±ì´ë‹¤ ì •ì„±.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ì´ë¦¬ ì£¼ì‹­ì‹œì˜¤. ê°™ì´ ë‹¦ì•„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ìˆœìˆœíˆ ì²­ëª…ì˜ ê²€ì„ ë°›ì•„ë“­ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ë¹„ë„ëŠ” ì œ ë¶„ì‹ ì´ë‚˜ ë‹¤ë¦„ì—†ê±°ë“ ìš”. {í˜¸ì¹­}ì²˜ëŸ¼ìš”.",
                            log: "ë‹¹ë³´ê°€ ëŠë¼í•œ ë©˜íŠ¸ë¥¼ ë‚ ë¦½ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "ë¹„ë„ëŠ” ë„êµ¬ì¼ ë¿ì´ì§€ë§Œ {í˜¸ì¹­}... ì—íœ´, ë§ì„ ë§™ì‹œë‹¤.",
                            log: "ë‹¹ë³´ê°€ í•œìˆ¨ì„ ì‰¬ë©° ê³ ê°œë¥¼ ì “ìŠµë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë„ˆ ìš”ì¦˜ ìê¾¸ ë‚˜ ëª°ë˜ ì–´ë”” ë‚˜ê°€ëŠ” ê²ƒ ê°™ë‹¤? ìˆ˜ìƒí•´.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "{í˜¸ì¹­} ë“œë¦´ ìˆ  ì‚¬ëŸ¬ ê°”ë˜ ê²ë‹ˆë‹¤. ì—¬ê¸° ìˆìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ í’ˆ ì•ˆì—ì„œ ìˆ ë³‘ì„ êº¼ëƒ…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì˜¤~ ì €ë¥¼ ê·¸ë ‡ê²Œ ì§€ì¼œë³´ê³  ê³„ì…¨ë˜ ê²ë‹ˆê¹Œ?",
                            log: "ë‹¹ë³´ê°€ ë¶€ë„ëŸ¬ì›Œí•˜ëŠ” ì²™ ì—°ê¸°í•©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­} ì € ì•ˆ ë´ì£¼ì‹œë‹ˆê¹Œ ì €ë„ ì œ ê°ˆ ê¸¸ ì°¾ëŠ” ê±°ì£ !",
                            log: "ë‹¹ë³´ê°€ í™§ê¹€ì— ì•„ë¬´ ë§ì´ë‚˜ ë‚´ë±‰ìŠµë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ë‹¤ë¥¸ ë†ˆë“¤ì´ ë„ˆë³´ê³  ëŒ€ë‹¨í•œ ì•”ì¡´ì´ë¼ê³  ë– ë“œëŠ” ê±° ë³´ë‹ˆê¹Œ ì°¸ ì›ƒê¸°ì§€ë„ ì•Šë”ë¼.",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "ê·¸ëƒ¥ í•˜ëŠ” ì†Œë¦¬ë“¤ì´ì£ . ì‹ ê²½ ì“°ì§€ ë§ˆì‹­ì‹œì˜¤.",
                            log: "ë‹¹ë³´ê°€ ë¬´ì‹¬í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì§ˆíˆ¬í•˜ëŠ” {í˜¸ì¹­} ëª¨ìŠµì´ ë” ì›ƒê¸´ë°ìš”? ê·€ì—½ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ì²­ëª…ì„ ë†€ë¦¬ë©° ì›ƒìŒì„ í„°ëœ¨ë¦½ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­}í•œí…Œë§Œ ì¸ì •ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤. ë”´ ë†ˆë“¤ì€ ìƒê´€ì—†ì–´ìš”.",
                            log: "ë‹¹ë³´ê°€ ì§„ì§€í•œ ëˆˆë¹›ìœ¼ë¡œ ì²­ëª…ì„ ë´…ë‹ˆë‹¤."
                        }
                    }
                    },
                {
                    t1: "ì•¼... ë„ˆ, ê·¸... ì•„ê¹Œ ì›ƒì–´ì¤€ ê±°. ê·¸ê±° ë‚˜í•œí…Œë§Œ í•´ë¼. ë”´ ë†ˆë“¤í•œí…Œ í˜ë¦¬ê³  ë‹¤ë‹ˆì§€ ë§ê³ .",
                    reaction: {
                        "ë¬´ë˜í•¨": {
                            t2: "...ì˜ˆ? ì•„, ì•Œê² ìŠµë‹ˆë‹¤.",
                            log: "ë‹¹ë³´ê°€ ë‹¹í™©í•˜ë©° ê³ ê°œë¥¼ ë„ë•ì…ë‹ˆë‹¤."
                        },
                        "ëŠ¥ê¸€ë§ìŒ": {
                            t2: "ì–´ë¨¸ë‚˜, {í˜¸ì¹­} ì§€ê¸ˆ ì†Œìœ ìš• ë¶€ë¦¬ì‹œëŠ” ê²ë‹ˆê¹Œ? ì–´ë–¡í•´~",
                            log: "ë‹¹ë³´ê°€ ì–¼êµ´ì„ ë¶‰íˆë©° ì¢‹ì•„í•©ë‹ˆë‹¤."
                        },
                        "ì§ˆíˆ¬ë§ìŒ": {
                            t2: "{í˜¸ì¹­}ì•¼ë§ë¡œ ì•„ë¬´í•œí…Œë‚˜ ê·¸ë ‡ê²Œ í¼ì£¼ì§€ ë§ˆì‹­ì‡¼!",
                            log: "ë‹¹ë³´ë„ ì§€ì§€ ì•Šê³  ë§ë°›ì•„ì¹©ë‹ˆë‹¤."
                        }
                    }
                    }
                ]
        },
        /// 4. ê³„ì ˆ ëŒ€ì‚¬ (ì„±ê²© ë¬´ê´€ ê³µí†µ)
        "season": {
            spring: [{
                t1: "ë§¤í™”ê°€ íë“œëŸ¬ì§€ê²Œ íˆìŠµë‹ˆë‹¤, {í˜¸ì¹­}.",
                t2: "ìˆ ë§› ë‹ìš°ëŠ”êµ°.",
                log: "ê½ƒêµ¬ê²½ì„ í•˜ë©° ìˆ ì„ ë§ˆì‹­ë‹ˆë‹¤."
                }],
            summer: [{
                t1: "ë”ì›Œ ì£½ê² ìŠµë‹ˆë‹¤... í—¥í—¥.",
                t2: "ë„ì‚¬ê°€ ë”ìœ„ë¥¼ íƒ€ì„œì•¼ ì›.",
                log: "ë¬´ë”ìœ„ì— ì§€ì³ê°‘ë‹ˆë‹¤."
                }],
            autumn: [{
                t1: "ë‚™ì—½ì´ ì§€ë‹ˆ ì“¸ì“¸í•˜êµ°ìš”.",
                t2: "ì²­ìŠ¹ ë–¨ì§€ ë§ˆë¼.",
                log: "ê°€ì„ íƒ€ëŠ” ì¤‘ì…ë‹ˆë‹¤."
                }],
            winter: [{
                t1: "ìˆ ì´ ì–¼ê² ìŠµë‹ˆë‹¤, {í˜¸ì¹­}.",
                t2: "ë°ì›Œ ë§ˆì‹œë©´ ê·¸ë§Œì´ë‹¤.",
                log: "ì¶”ìœ„ë¥¼ ìˆ ë¡œ ë‹¬ë©ë‹ˆë‹¤."
                }]
        },

        // 5. í˜¼ì£ë§
        solo: {
            dangbo: ["{í˜¸ì¹­}ì€ ì˜¤ëŠ˜ë„ ê¸°ìš´ì´ ë„˜ì¹˜ì‹œëŠ”êµ°.", "ë…ì„ ì¢€ ë” ê°œëŸ‰í•´ë³¼ê¹Œ...", "ë¹„ë„ ë‹¦ê¸° ì¢‹ì€ ë‚ ì”¨ë‹¤."],
            chung: ["ì•„ì˜¤, ì‚­ì‹ ì´ì•¼.", "ë‹¹ê³¼ê°€ ë‹¤ ë–¨ì–´ì¡ŒëŠ”ë°...", "ìˆ  ê°€ì ¸ì™€, ìˆ !"]
        },

        // 4. ìœ ëŒ ì‹œìŠ¤í…œ ì „ìš© (ë‚˜ì¤‘ì— ìœ ëŒ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ì‚¬ìš©)
        travel: [{
                log: "ë‘ ì‚¬ëŒì´ ê°•í˜¸í–‰ì„ ë– ë‚©ë‹ˆë‹¤. (ìœ ëŒ ì¤‘)"
                },
            {
                log: "ìœ ëª…í•œ ê°ì”ì—ì„œ êµ­ìˆ˜ë¥¼ ì‚¬ ë¨¹ìŠµë‹ˆë‹¤. (ìœ ëŒ ì¤‘)"
                },
            {
                log: "ì‚°ì  ë–¼ë¥¼ ë§Œë‚¬ì§€ë§Œ ê°€ë³ê²Œ ì†ë´ì¤ë‹ˆë‹¤. (ìœ ëŒ ì¤‘)"
                },
            {
                log: "ê²½ì¹˜ ì¢‹ì€ ì •ìì—ì„œ ë‚®ì ì„ ì¡ë‹ˆë‹¤. (ìœ ëŒ ì¤‘)"
                },
            {
                log: "ì‚¬ì²œë‹¹ê°€ì— ë“¤ëŸ¬ ë…ì„ ë³´ì¶©í•©ë‹ˆë‹¤. (ìœ ëŒ ì¤‘)"
                }
            ]
    };

    let currentUserId = 'dangbo';
    let currentTab = 'profile';
    let isInteracting = false;

    // ================= ì‹œê°„ ì‹œìŠ¤í…œ (1ê³„ì ˆ = 1ì‹œê°„) =================
    // 1ê³„ì ˆ = 3ë‹¬ = 90ì¼
    const DAY_IN_MS = 300000; // 5ë¶„

    // ì €ì¥ëœ ë‚ ì§œê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê³ , ì—†ìœ¼ë©´ 3ì›” 1ì¼ë¡œ ì‹œì‘
    let gameDate = JSON.parse(localStorage.getItem('savedGameDate')) || {
        month: 3,
        day: 1
    };
    let lastTimeCheck = Date.now();

    // ê³„ì ˆ ì •ë³´
    const seasonInfo = {
        spring: {
            name: "ë´„",
            icon: "ğŸŒ¸",
            filter: "none"
        },
        summer: {
            name: "ì—¬ë¦„",
            icon: "â˜€ï¸",
            filter: "saturate(1.2) brightness(1.1)"
        },
        autumn: {
            name: "ê°€ì„",
            icon: "ğŸ",
            filter: "sepia(0.4) contrast(1.1)"
        },
        winter: {
            name: "ê²¨ìš¸",
            icon: "â„ï¸",
            filter: "brightness(0.9) hue-rotate(10deg) grayscale(0.3)"
        }
    };

    function getSeason(month) {
        if (month >= 3 && month <= 5) return 'spring';
        if (month >= 6 && month <= 8) return 'summer';
        if (month >= 9 && month <= 11) return 'autumn';
        return 'winter'; // 12, 1, 2
    }

    function updateTime() {
        const now = Date.now();

        // í•˜ë£¨ê°€ ì§€ë‚¬ëŠ”ì§€ ì²´í¬
        if (now - lastTimeCheck >= DAY_IN_MS) {
            lastTimeCheck = now; // ê¸°ì¤€ ì‹œê°„ ì¬ì„¤ì •
            advanceDay();
        }

        // [ì¶”ê°€] ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì‹œê°„ì„ í™”ë©´ì— ê°±ì‹  (ì‹œê³„ê°€ íë¥´ê²Œ ë³´ì„)
        updateDateUI();

        requestAnimationFrame(updateTime);
    }

    // [ìˆ˜ì •] ë‚ ì§œ ë³€ê²½: ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ ë°œë™ ì¶”ê°€
    function advanceDay() {
        gameDate.day++;
        if (gameDate.day > 30) {
            gameDate.day = 1;
            gameDate.month++;
            if (gameDate.month > 12) gameDate.month = 1;
        }

        // ë‚ ì§œ ë³€ê²½ ë¡œê·¸ (ì´ë²¤íŠ¸ ì—¬ë¶€ í™•ì¸)
        const isEventDay = (gameDate.day === 10 || gameDate.day === 20 || gameDate.day === 30);
        addLog(`${gameDate.month}ì›” ${gameDate.day}ì¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤`, true);

        // ì´ë²¤íŠ¸ ë‚ ì´ë©´ ì´ë²¤íŠ¸ ì‹¤í–‰
        if (isEventDay) {
            setTimeout(triggerSpecialEvent, 1000);
        }

        localStorage.setItem('savedGameDate', JSON.stringify(gameDate));
        updateDateUI();
    }

    // [ì¶”ê°€] ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ í•¨ìˆ˜
    function triggerSpecialEvent() {
        const season = getSeason(gameDate.month);
        const data = specialEventDB[season];
        if (!data) return;

        // íŒì—… í‘œì‹œ
        const popup = document.getElementById('event-popup');
        document.getElementById('popup-title').innerText = data.title;
        document.getElementById('popup-desc').innerText = "ìŠ¤í˜ì…œ ì—í”¼ì†Œë“œ!";
        popup.classList.add('show');
        setTimeout(() => popup.classList.remove('show'), 3000);

        // ë¡œê·¸ ë° ëŒ€ì‚¬
        addLog(`<span style="color:#d35400;">[${data.title}]</span> ${data.log}`, false); // ì—¬ê¸° falseëŠ” ë‚ ì§œë¡œê·¸ ì•„ë‹˜ ì˜ë¯¸

        // ë§í’ì„  (ë‹¨ìˆœ í‘œì‹œ)
        showBubble('dangbo', data.talk.dangbo, 'high');
        setTimeout(() => showBubble('chung', data.talk.chung, 'low'), 1500);
    }

    function updateDateUI() {
        const seasonKey = getSeason(gameDate.month);
        const season = seasonInfo[seasonKey];

        // [ìˆ˜ì •] í—¤ë” í…ìŠ¤íŠ¸ë¥¼ 'ê¸°ë¡' íƒ€ì´í‹€ê³¼ í•©ì³ì„œ í‘œì‹œ
        const header = document.getElementById('log-header-text');
        // ì˜ˆì‹œ: ğŸŒ¸ ë´„ | 3ì›” 1ì¼ì˜ ê¸°ë¡
        header.innerText = `${season.icon} ${season.name} | ${gameDate.month}ì›” ${gameDate.day}ì¼ì˜ ê¸°ë¡`;

        // ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½
        const bg = document.getElementById('game-bg');
        bg.style.backgroundImage = `url('bg/${seasonKey}.jpg')`;
    }


    // ================= UI ë¡œì§ =================
    function toggleInfoPanel() {
        const panel = document.getElementById('info-panel');
        const btn = document.getElementById('mobile-toggle-btn');
        panel.classList.toggle('open');
        btn.innerText = panel.classList.contains('open') ? 'â–²' : 'â–¼';
    }

    function selectCharacter(id) {
        currentUserId = id;
        document.querySelectorAll('.char-select-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id === 'dangbo' ? 'btn-dangbo' : 'btn-chung').classList.add('active');
        renderInfoContent();
    }

    function switchTab(tabName) {
        currentTab = tabName;
        // ëª¨ë“  ë²„íŠ¼ì—ì„œ active ì œê±°
        document.querySelectorAll('.sub-tab-btn').forEach(b => {
            b.classList.remove('active');
            // í´ë¦­ëœ íƒ­ ì´ë¦„ê³¼ ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ê°€ ì¼ì¹˜í•˜ë©´ active ì¶”ê°€ (ë” í™•ì‹¤í•œ ë°©ë²•)
            const tabMap = {
                'profile': 'í”„ë¡œí•„',
                'inventory': 'ì†Œì§€í’ˆ',
                'relation': 'ê´€ê³„'
            };
            if (b.innerText === tabMap[tabName]) b.classList.add('active');
        });
        renderInfoContent();
    }

    function renderInfoContent() {
        const data = charData[currentUserId];
        const display = document.getElementById('info-display-area');
        let html = '';

        if (currentTab === 'profile') {
            const traitOptions = personalityList.map(p =>
                `<option value="${p}" ${data.trait === p ? 'selected' : ''}>${p}</option>`
            ).join('');

            // ë°°ê²½ìƒ‰ì— ë”°ë¼ ê¸€ììƒ‰(í°/ê²€) ìë™ ê³„ì‚° (ì´ë¦„í‘œ ê°€ë…ì„±ìš©)
            const nameTagColor = getContrastYIQ(data.color);

            html = `
                    <div style="text-align:center; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #eee;">
                        <h2 style="color:${data.color}; margin-bottom:5px;">${data.name}</h2>
                        <span style="background:${data.color}; color:${nameTagColor}; padding:3px 8px; border-radius:10px; font-size:0.8rem;">${data.title}</span>
                    </div>
                    
                    <div class="info-box">
                        <span class="info-label">ğŸ¨ ëŒ€í‘œ ì»¬ëŸ¬ ì„¤ì •</span>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <input type="color" value="${data.color}" onchange="updateCharSetting('color', this.value)" style="width:50px; height:30px; padding:0; border:none; background:none; cursor:pointer;">
                            <span style="font-size:0.8rem; color:#666;">í´ë¦­í•˜ì—¬ ë§í’ì„  ìƒ‰ ë³€ê²½</span>
                        </div>
                    </div>

                    <div class="info-box">
                        <span class="info-label">âš§ ì„±ë³„ ì„¤ì •</span>
                        <select class="custom-select" onchange="updateCharSetting('gender', this.value)">
                            <option value="ë‚¨ì„±" ${data.gender === 'ë‚¨ì„±' ? 'selected' : ''}>ë‚¨ì„± â™‚ï¸</option>
                            <option value="ì—¬ì„±" ${data.gender === 'ì—¬ì„±' ? 'selected' : ''}>ì—¬ì„± â™€ï¸</option>
                        </select>
                    </div>

                    <div class="info-box">
                        <span class="info-label">ğŸ§  ì„±ê²© ì„¤ì •</span>
                        <select class="custom-select" onchange="updateCharSetting('trait', this.value)">
                            ${traitOptions}
                        </select>
                    </div>

                    <button class="save-btn" onclick="saveCharacterSettings()">ğŸ’¾ ì„¤ì • ì €ì¥í•˜ê¸°</button>
                `;
        } else if (currentTab === 'inventory') {
            html = `<div style="padding:5px;">
                        <div style="margin-bottom:10px; font-weight:bold; color:#555;">ì†Œì§€í•˜ê³  ìˆëŠ” ë¬¼í’ˆ</div>
                        ${data.inventory.map(i => `<span class="item-badge">${i}</span>`).join('')}
                        </div>`;
        } else if (currentTab === 'relation') {
            html = `<div style="padding:5px;">
                        ${data.relations.map(r => `
                        <div class="rel-card">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                                <strong style="font-size:1rem;">To. ${r.target}</strong>
                                <span style="font-size:0.8rem; background:#eee; padding:2px 6px; border-radius:4px;">${r.rel}</span>
                            </div>
                            <div style="font-size:0.9rem; color:#666;">${r.desc}</div>
                        </div>`).join('')}
                        </div>`;
        }
        display.innerHTML = html;
    }

    // [ì¤‘ìš”] ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ ì¶”ê°€
    function saveCharacterSettings() {
        // í˜„ì¬ charData ì „ì²´ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        localStorage.setItem('hapsa_char_settings', JSON.stringify(charData));
        alert("ìºë¦­í„° ì„±ë³„ê³¼ ì„±ê²©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    function loadCharacterSettings() {
        const saved = localStorage.getItem('hapsa_char_settings');
        if (saved) {
            const parsed = JSON.parse(saved);
            // ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
            Object.keys(parsed).forEach(key => {
                if (charData[key]) {
                    charData[key].gender = parsed[key].gender;
                    charData[key].trait = parsed[key].trait;
                }
            });
        }
    }

    // ì„¤ì • ì €ì¥ìš© í—¬í¼ í•¨ìˆ˜
    function updateCharSetting(key, value) {
        if (charData[currentUserId]) {
            charData[currentUserId][key] = value;
            // ì„±ê²©ì´ ë°”ë€Œë©´ ë‹¤ìŒ ëŒ€í™”ë¶€í„° ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤.
        }
    }

    function addLog(msg, isSpecial = false) {
        const box = document.getElementById('log-box');
        const d = document.createElement('div');

        // 1. ë‚ ì§œ ë³€ê²½ ì•Œë¦¼ (íŠ¹ìˆ˜ ì²˜ë¦¬)
        if (isSpecial) {
            d.className = 'log-entry log-date';
            d.innerHTML = `<div style="font-weight:bold; font-style:italic; opacity:0.8;">â”€ ${msg} â”€</div>`;
        }
        // 2. ì¼ë°˜ ë¡œê·¸ (ëŒ€í™”, ì‹œìŠ¤í…œ ë“±)
        else {
            // ê¸°ë³¸ í´ë˜ìŠ¤ ì„¤ì •
            d.className = 'log-entry';

            // ë‚´ìš©ì— ë”°ë¼ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€ (í‚¤ì›Œë“œ ë¶„ì„)
            if (msg.includes('[ëŒ€í™”]')) {
                d.classList.add('log-social'); // íŒŒë€ìƒ‰ ë 
            } else if (msg.includes('[ë…ë°±]')) {
                d.classList.add('log-system'); // íšŒìƒ‰ ë 
            } else {
                d.classList.add('log-system'); // ê¸°ë³¸
            }

            // ì‹œê°„ êµ¬í•˜ê¸° (ì´ˆ ë‹¨ìœ„ í¬í•¨)
            const timeStr = new Date().toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            // HTML ì¡°ë¦½ (ì‹œê°„ + ë‚´ìš©)
            // ê¸°ì¡´ msgì—ì„œ [ëŒ€í™”] ê°™ì€ íƒœê·¸ë¥¼ ì¢€ ë” ì§„í•˜ê²Œ í‘œì‹œí•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ replace ì‚¬ìš© ê°€ëŠ¥
            const formattedMsg = msg.replace(/\[(.*?)\]/g, '<span style="font-weight:bold;">[$1]</span>');

            d.innerHTML = `<span class="log-time">${timeStr}</span>${formattedMsg}`;
        }

        box.prepend(d);

        // ë¡œê·¸ê°€ 50ê°œ ë„˜ì–´ê°€ë©´ ì˜¤ë˜ëœ ê²ƒ ì‚­ì œ (ë ‰ ë°©ì§€)
        if (box.children.length > 50) {
            box.lastChild.remove();
        }
    }

    // ================= ìºë¦­í„° ì´ë™ ë° ìƒí˜¸ì‘ìš© =================
    function initCharacters() {
        const stage = document.getElementById('game-stage');
        for (const [id, data] of Object.entries(charData)) {
            const el = document.createElement('div');
            el.className = 'character-sprite';
            el.id = `char-${id}`;
            el.style.left = data.x + '%';
            el.style.top = data.y + '%';
            el.innerHTML = `
                    <div class="bubble" id="bubble-${id}">...</div>
                    <img src="${data.img}" onerror="this.src='https://via.placeholder.com/100?text=${data.name}'">
                    <div style="background:rgba(0,0,0,0.6); color:white; font-size:11px; padding:2px 6px; border-radius:10px; margin-top:5px; font-weight:bold;">${data.name}</div>
                `;
            el.onclick = () => {
                selectCharacter(id);
                if (window.innerWidth <= 768) toggleInfoPanel();
            };
            stage.appendChild(el);
            scheduleNextMove(id);
        }
    }

    function moveTo(id, targetX, targetY, callback) {
        const el = document.getElementById(`char-${id}`);
        const data = charData[id];

        const dist = Math.sqrt(Math.pow(targetX - data.x, 2) + Math.pow(targetY - data.y, 2));
        const speedFactor = 0.05;
        const duration = Math.max(1.5, dist * speedFactor);

        el.style.transition = `top ${duration}s linear, left ${duration}s linear`;
        el.classList.add('walking');
        el.style.left = targetX + '%';
        el.style.top = targetY + '%';

        data.x = targetX;
        data.y = targetY;

        setTimeout(() => {
            el.classList.remove('walking');
            if (callback) callback();
        }, duration * 1000);
    }

    // [ìˆ˜ì •] í–‰ë™ ìŠ¤ì¼€ì¤„ë§: ì¿¨íƒ€ì„ ì²´í¬ ì¶”ê°€ (ìœ ë ¹ ë°©ì§€ ë¡œì§ ìœ ì§€)
    function scheduleNextMove(id) {
        if (isInteracting) return; // ìƒí˜¸ì‘ìš© ì¤‘ì´ë©´ ì•„ì˜ˆ ëª…ë ¹ ê±°ë¶€

        const waitTime = Math.random() * 2000 + 1000;

        setTimeout(() => {
            if (isInteracting) {
                scheduleNextMove(id); // ìƒí˜¸ì‘ìš© ì¤‘ì´ë©´ ë‚˜ì¤‘ì— ë‹¤ì‹œ í™•ì¸ (ì•ˆì „)
                return;
            }

            const rand = Math.random();
            // ì¿¨íƒ€ì„ ì²´í¬ (10ì´ˆ)
            const isCooltime = (Date.now() - lastDialogTime) < 10000;

            // 1. ìƒí˜¸ì‘ìš© (ë‹¹ë³´ 40% + ì¿¨íƒ€ì„ ì•„ë‹˜)
            if (id === 'dangbo' && rand < 0.4 && !isCooltime) {
                triggerInteraction();
            }
            // 2. í˜¼ì£ë§ (30%)
            else if (rand < 0.7) {
                triggerMonologue(id);
                const tx = Math.random() * 80 + 10;
                const ty = Math.random() * 60 + 20;
                moveTo(id, tx, ty, () => scheduleNextMove(id));
            }
            // 3. ê·¸ëƒ¥ ì´ë™
            else {
                const tx = Math.random() * 80 + 10;
                const ty = Math.random() * 60 + 20;
                moveTo(id, tx, ty, () => scheduleNextMove(id));
            }
        }, waitTime);
    }

    function triggerInteraction() {
        if (isInteracting) return;
        isInteracting = true;

        const c1 = charData['dangbo'];
        const c2 = charData['chung'];
        const meetX = (c1.x + c2.x) / 2;
        const meetY = (c1.y + c2.y) / 2;

        let arrivedCount = 0;
        const onArrive = () => {
            arrivedCount++;
            if (arrivedCount === 2) startDialog();
        };

        moveTo('dangbo', meetX - 8, meetY, onArrive);
        moveTo('chung', meetX + 8, meetY, onArrive);
    }

    function startDialog() {
        const dangboData = charData['dangbo'];
        const chungData = charData['chung'];

        // 1. í˜¸ì¹­ ì •ë¦¬ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        let title = "ë„ì‚¬ í˜•ë‹˜";
        if (dangboData.gender === 'ì—¬ì„±' && chungData.gender === 'ì—¬ì„±') title = "ë„ì‚¬ ì–¸ë‹ˆ";
        else if (dangboData.gender === 'ë‚¨ì„±' && chungData.gender === 'ì—¬ì„±') title = "ë„ì‚¬ ëˆ„ë‹˜";

        // 2. [í•µì‹¬] ë™ì „ ë˜ì§€ê¸° (50% í™•ë¥ ë¡œ í™”ì ê²°ì •)
        const isDangboStarts = Math.random() < 0.5;

        let dbSection, starterId, listenerId, starterPers, listenerPers;

        if (isDangboStarts) {
            dbSection = dialogDB.dangbo_start; // ë‹¹ë³´ê°€ ë§ ê±°ëŠ” êµ¬ì—­
            starterId = 'dangbo';
            listenerId = 'chung';
            starterPers = dangboData.trait; // ë‹¹ë³´ì˜ í˜„ì¬ ì„±ê²©
            listenerPers = chungData.trait; // ì²­ëª…ì˜ í˜„ì¬ ì„±ê²©
        } else {
            dbSection = dialogDB.chung_start; // ì²­ëª…ì´ ë§ ê±°ëŠ” êµ¬ì—­
            starterId = 'chung';
            listenerId = 'dangbo';
            starterPers = chungData.trait; // ì²­ëª…ì˜ í˜„ì¬ ì„±ê²©
            listenerPers = dangboData.trait; // ë‹¹ë³´ì˜ í˜„ì¬ ì„±ê²©
        }

        // 3. ì„±ê²©ì— ë§ëŠ” ëŒ€ì‚¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ë¬´ë˜í•¨ ê¸°ë³¸)
        const possibleList = dbSection[starterPers] || dbSection["ë¬´ë˜í•¨"];
        const scenario = possibleList[Math.floor(Math.random() * possibleList.length)];

        // 4. ìƒëŒ€ë°©ì˜ ì„±ê²©ì— ë§ëŠ” ë°˜ì‘(Reaction) ê°€ì ¸ì˜¤ê¸°
        const response = scenario.reaction[listenerPers] || scenario.reaction["ë¬´ë˜í•¨"];

        // 5. ë§í’ì„  ë„ìš°ê¸° (t1: ì„ ì°½ì, t2: ì‘ë‹µì)
        // ë‹¹ë³´ëŠ” high ìŠ¤íƒ€ì¼, ì²­ëª…ì€ low ìŠ¤íƒ€ì¼ë¡œ êµ¬ë¶„í•´ì„œ ì¶œë ¥
        showBubble(starterId, fillTitle(scenario.t1, title), starterId === 'dangbo' ? 'high' : 'low');

        setTimeout(() => {
            showBubble(listenerId, fillTitle(response.t2, title), listenerId === 'dangbo' ? 'high' : 'low');
            addLog(`[ëŒ€í™”] ${fillTitle(response.log, title)}`);

            // 6. ëŒ€í™” ì¢…ë£Œ ì²˜ë¦¬
            setTimeout(() => {
                isInteracting = false;
                lastDialogTime = Date.now();
                localStorage.setItem('savedLastDialogTime', lastDialogTime);
                scheduleNextMove('dangbo');
                scheduleNextMove('chung');
            }, 2500);
        }, 2000);
    }

    function triggerMonologue(id) {
        // 1. ë°ì´í„°ê°€ ìˆëŠ”ì§€ ë¨¼ì € ì•ˆì „í•˜ê²Œ í™•ì¸
        if (!dialogDB.solo || !dialogDB.solo[id]) {
            console.warn(`${id}ì˜ ë…ë°± ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
            return;
        }

        const lines = dialogDB.solo[id];
        let text = lines[Math.floor(Math.random() * lines.length)];

        const dangbo = charData['dangbo'];
        const chung = charData['chung'];

        // 2. í˜¸ì¹­ ê²°ì • ë¡œì§
        let title = "í˜•ë‹˜";
        if (dangbo.gender === 'ì—¬ì„±' && chung.gender === 'ì—¬ì„±') title = "ì–¸ë‹ˆ";
        else if (dangbo.gender === 'ë‚¨ì„±' && chung.gender === 'ì—¬ì„±') title = "ëˆ„ë‹˜";
        else if (id === 'dangbo') title = "ë„ì‚¬ í˜•ë‹˜";

        // 3. ì¡°ì‚¬ ë³´ì • ë° ì¶œë ¥
        text = fillTitle(text, title);
        showBubble(id, text);
    }

    // [ì¶”ê°€] ì¿¨íƒ€ì„ ê´€ë¦¬
    let lastDialogTime = parseInt(localStorage.getItem('savedLastDialogTime')) || 0;

    // [ì¶”ê°€] ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ ë°ì´í„°
    const specialEventDB = {
        spring: {
            title: "â­ï¸ ì¢…ë‚¨íŒŒ í˜¼ë‚´ì£¼ê¸°",
            log: "ì¢…ë‚¨ì˜ ë©ì²­ì´ë“¤ì„ ë‘ë“¤ê²¨ íŒ¨ì¤¬ìŠµë‹ˆë‹¤!",
            talk: {
                dangbo: "í˜•ë‹˜ êµ¬ì—­ì—ì„œ ì–¼ì©¡ê±°ë¦¬ë‹¤ë‹ˆ.",
                chung: "ë‹¤ì‹  ëª» ì˜¤ê²Œ ë‹¤ë¦¬ë¥¼ ë¶„ì§ˆëŸ¬ë†”!"
            }
        },
        summer: {
            title: "â­ï¸ ìˆ˜ë°• ì„œë¦¬",
            log: "ë‚¨ì˜ ë°­ì—ì„œ ìˆ˜ë°•ì„ ì„œë¦¬í•´ ë¨¹ì—ˆìŠµë‹ˆë‹¤.",
            talk: {
                dangbo: "ì—­ì‹œ í›”ì³ ë¨¹ëŠ” ê²Œ ì œë§›ì´ì£ .",
                chung: "ì•„ì‚­í•˜ë‹ˆ ì¢‹ë„¤!"
            }
        },
        autumn: {
            title: "â­ï¸ ìˆ ë… ë„ì¥ ê¹¨ê¸°",
            log: "ê°ì”ì˜ ìˆ ì„ ëª¨ì¡°ë¦¬ ë§ˆì…”ë²„ë ¸ìŠµë‹ˆë‹¤.",
            talk: {
                dangbo: "í˜•ë‹˜, í•œ ë³‘ ë”?",
                chung: "ì˜¤ëŠ˜ ë‹¤ ì£½ëŠ” ê±°ì•¼!"
            }
        },
        winter: {
            title: "â­ï¸ ì„¤ì› ë¹„ë¬´",
            log: "ëˆˆë°­ì—ì„œ ê²©ë ¬í•œ ë¹„ë¬´ë¥¼ í¼ì³¤ìŠµë‹ˆë‹¤.",
            talk: {
                dangbo: "ì†ì´ ê³±ì•„ì„œ ì œëŒ€ë¡œ ëª» ë˜ì§€ê² ì†Œ.",
                chung: "í•‘ê³„ ëŒ€ì§€ ë§ˆë¼!"
            }
        }
    };




    // ================= í…Œë§ˆ ë° ì‹¤í–‰ =================
    const themeToggleBtn = document.getElementById('theme-toggle');
    const bodyElement = document.body;

    function applyTheme(theme) {
        if (theme === 'dark') bodyElement.classList.add('dark-theme');
        else bodyElement.classList.remove('dark-theme');
        themeToggleBtn.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }
    themeToggleBtn.addEventListener('click', () => {
        bodyElement.classList.toggle('dark-theme');
        applyTheme(bodyElement.classList.contains('dark-theme') ? 'dark' : 'light');
    });

    // [ë³µêµ¬] ì¡°ì‚¬ ìë™ ë³´ì • (ì€/ëŠ”, ì´/ê°€ ë“±)
    function fillTitle(text, title) {
        let result = text.replace(/{í˜¸ì¹­}/g, title);
        const regex = new RegExp(`(${title})(ì€|ëŠ”|ì´|ê°€|ì„|ë¥¼|ê³¼|ì™€)`, 'g');
        return result.replace(regex, (match, word, josa) => {
            const lastChar = word.charCodeAt(word.length - 1);
            if (lastChar < 0xAC00 || lastChar > 0xD7A3) return match;
            const hasBatchim = (lastChar - 0xAC00) % 28 > 0;
            if (josa === 'ì€' || josa === 'ëŠ”') return word + (hasBatchim ? 'ì€' : 'ëŠ”');
            if (josa === 'ì´' || josa === 'ê°€') return word + (hasBatchim ? 'ì´' : 'ê°€');
            if (josa === 'ì„' || josa === 'ë¥¼') return word + (hasBatchim ? 'ì„' : 'ë¥¼');
            if (josa === 'ê³¼' || josa === 'ì™€') return word + (hasBatchim ? 'ê³¼' : 'ì™€');
            return match;
        });
    }

    // [ë³µêµ¬] ë°°ê²½ìƒ‰ì— ë”°ë¼ ê¸€ììƒ‰(í°/ê²€) ê²°ì •
    function getContrastYIQ(hexcolor) {
        if (!hexcolor) return 'black';
        const r = parseInt(hexcolor.substr(1, 2), 16);
        const g = parseInt(hexcolor.substr(3, 2), 16);
        const b = parseInt(hexcolor.substr(5, 2), 16);
        return (((r * 299) + (g * 587) + (b * 114)) / 1000) >= 128 ? 'black' : 'white';
    }

    // [ë³µêµ¬] ë§í’ì„  í‘œì‹œ (ìœ„ì¹˜/ìƒ‰ìƒ ì ìš©)
    function showBubble(charId, text, styleType = 'normal') {
        const d = charData[charId];
        const charEl = document.getElementById(`char-${charId}`);

        // ê¸°ì¡´ bubble ìš”ì†Œ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„± (ìŠ¤íƒ€ì¼ ì¶©ëŒ ë°©ì§€)
        const oldBubble = document.getElementById(`bubble-${charId}`);
        if (oldBubble) oldBubble.remove();

        const bubble = document.createElement('div');
        bubble.id = `bubble-${charId}`;
        bubble.className = 'char-bubble'; // ìƒˆë¡œ ì •ì˜í•œ CSS í´ë˜ìŠ¤

        // ìƒ‰ìƒ ì ìš©
        const bgColor = d.color || "#ffffff";
        bubble.style.setProperty('--bubble-bg', bgColor);
        bubble.style.setProperty('--bubble-text', getContrastYIQ(bgColor));

        // ìœ„ì¹˜ í´ë˜ìŠ¤ ì ìš©
        if (styleType === 'high') bubble.classList.add('pos-high');
        else if (styleType === 'low') bubble.classList.add('pos-low');

        bubble.innerText = text;
        charEl.appendChild(bubble);

        // ì• ë‹ˆë©”ì´ì…˜
        requestAnimationFrame(() => bubble.classList.add('show'));
        setTimeout(() => {
            bubble.classList.remove('show');
            setTimeout(() => bubble.remove(), 300);
        }, 3500);
    }

    // [ì¶”ê°€] ë””ë²„ê·¸ ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°
    function toggleDebugMenu() {
        const modal = document.getElementById('debug-modal');
        modal.classList.toggle('open');

        // ë©”ë‰´ ì—´ ë•Œ í˜„ì¬ ë‚ ì§œë¥¼ ì…ë ¥ì¹¸ì— ì±„ì›Œë„£ê¸° (í¸ì˜ì„±)
        if (modal.classList.contains('open')) {
            document.getElementById('debug-month').value = gameDate.month;
            document.getElementById('debug-day').value = gameDate.day;
        }
    }

    // [ì¶”ê°€] ë‚ ì§œ ê°•ì œ ì´ë™ í•¨ìˆ˜
    function warpDate() {
        const m = parseInt(document.getElementById('debug-month').value);
        const d = parseInt(document.getElementById('debug-day').value);

        // ìœ íš¨ì„± ê²€ì‚¬
        if (isNaN(m) || isNaN(d) || m < 1 || m > 12 || d < 1 || d > 30) {
            alert("ë‚ ì§œë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”! (1~12ì›”, 1~30ì¼)");
            return;
        }

        // ë‚ ì§œ ë³€ê²½ ì ìš©
        gameDate.month = m;
        gameDate.day = d;

        // ë³€ê²½ëœ ë‚ ì§œ ì €ì¥ ë° UI ê°±ì‹ 
        localStorage.setItem('savedGameDate', JSON.stringify(gameDate));
        updateDateUI();

        // ë¡œê·¸ì— ê¸°ë¡ ë‚¨ê¸°ê¸°
        addLog(`[ì‹œìŠ¤í…œ] âš™ï¸ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹œê°„ì„ ${m}ì›” ${d}ì¼ë¡œ ëŒë ¸ìŠµë‹ˆë‹¤.`, true);

        // ë©”ë‰´ ë‹«ê¸°
        toggleDebugMenu();

        // ë§Œì•½ 10, 20, 30ì¼ë¡œ ì´ë™í–ˆë‹¤ë©´ ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ê°€ ë°”ë¡œ í„°ì§€ë„ë¡ ì²´í¬í•˜ê³  ì‹¶ë‹¤ë©´:
        // if (d === 10 || d === 20 || d === 30) setTimeout(triggerSpecialEvent, 1000);
    }


    loadCharacterSettings();
    renderInfoContent();
    initCharacters();
    updateDateUI();
    updateTime();


    // HTMLì˜ onclickì—ì„œ ì´ í•¨ìˆ˜ë“¤ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì „ì—­(window)ìœ¼ë¡œ ê³µê°œí•©ë‹ˆë‹¤.
    window.selectCharacter = selectCharacter;
    window.switchTab = switchTab;
    window.toggleInfoPanel = toggleInfoPanel;
    window.saveCharacterSettings = saveCharacterSettings;
    window.updateCharSetting = updateCharSetting;
    window.toggleDebugMenu = toggleDebugMenu;
    window.warpDate = warpDate;
});
